<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System | Pirate Galaxy</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="css/game-styles.css">
</head>
<body class="bg-gray-950 text-gray-100">

    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-6 py-4">
        <div class="flex items-center gap-2 text-sm text-gray-400">
            <a href="index.html" class="hover:text-blue-400 transition">Home</a>
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
            <a href="universe.html" class="hover:text-blue-400 transition">Universe</a>
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
            <span id="breadcrumb-system" class="text-blue-400">Loading...</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-6 pb-12">
        
        <!-- System Header -->
        <div class="content-panel p-8 mb-8">
            <div class="flex items-start justify-between mb-6">
                <div class="flex items-center gap-6">
                    <div id="system-icon" class="w-20 h-20 rounded-full bg-blue-500/20 flex items-center justify-center">
                        <i data-lucide="circle-dot" class="w-10 h-10 text-blue-400"></i>
                    </div>
                    <div>
                        <h1 id="system-name" class="text-4xl font-bold text-blue-300 mb-2">Loading...</h1>
                        <p id="system-description" class="text-gray-400 max-w-2xl"></p>
                    </div>
                </div>
                <div class="text-right">
                    <div id="system-level" class="text-3xl font-bold text-yellow-400 mb-1">-</div>
                    <div class="text-sm text-gray-500">Min Level Required</div>
                </div>
            </div>

            <!-- System Stats -->
            <div class="grid md:grid-cols-4 gap-4">
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div id="planet-count" class="text-2xl font-bold text-blue-400 mb-1">-</div>
                    <div class="text-xs text-gray-400">Planets</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div id="stargate-status" class="text-2xl font-bold text-green-400 mb-1">-</div>
                    <div class="text-xs text-gray-400">Stargate</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div id="system-type" class="text-2xl font-bold text-purple-400 mb-1">-</div>
                    <div class="text-xs text-gray-400">Type</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div id="special-features" class="text-2xl font-bold text-pink-400 mb-1">-</div>
                    <div class="text-xs text-gray-400">Special Features</div>
                </div>
            </div>
        </div>

        <!-- Special Notice for Sirius -->
        <div id="sirius-notice" class="hidden content-panel p-6 mb-8 border-cyan-500/50 bg-cyan-500/5">
            <div class="flex items-start gap-4">
                <i data-lucide="alert-circle" class="w-6 h-6 text-cyan-400 flex-shrink-0 mt-1"></i>
                <div>
                    <h3 class="text-lg font-bold text-cyan-300 mb-2">Sirius Singularity</h3>
                    <p class="text-gray-300 mb-3">
                        Sirius is a unique singularity with up to <strong class="text-cyan-400">32 dynamic planets</strong> 
                        that change periodically. Each planet offers unique resources, blueprints, and challenges.
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded text-sm">Resource Planets</span>
                        <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded text-sm">Ancient Planets</span>
                        <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded text-sm">Unique Effects</span>
                        <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded text-sm">Rare Blueprints</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Planets Section -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-blue-300 flex items-center gap-3">
                    <i data-lucide="globe" class="w-6 h-6"></i>
                    Planets in this System
                </h2>
                <button onclick="toggleView()" class="game-nav-item text-sm">
                    <i data-lucide="layout-grid" id="view-icon" class="inline w-4 h-4 mr-1"></i>
                    <span id="view-text">Grid View</span>
                </button>
            </div>

            <!-- Planets Grid -->
            <div id="planets-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Planets will be loaded here -->
            </div>

            <!-- No Planets Message -->
            <div id="no-planets" class="hidden content-panel p-12 text-center">
                <i data-lucide="globe" class="w-16 h-16 mx-auto text-gray-600 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-400 mb-2">Dynamic System</h3>
                <p class="text-gray-500">This system has dynamic planets that change over time</p>
            </div>
        </div>

        <!-- Ships Available in This System -->
        <div class="content-panel p-6">
            <h3 class="text-xl font-bold text-blue-300 mb-4 flex items-center gap-2">
                <i data-lucide="rocket" class="w-5 h-5"></i>
                Ships Available in <span id="system-ships-name">this System</span>
            </h3>
            <div id="system-ships" class="grid md:grid-cols-2 lg:grid-cols-4 gap-3">
                <!-- Ships will be loaded here -->
            </div>
            <div id="no-ships" class="hidden text-center py-8 text-gray-500">
                <p>No ship data available for this system yet</p>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="js/component-loader.js"></script>
    <script>
        let currentSystem = null;
        let currentView = 'grid';

        async function loadSystemData() {
            const params = new URLSearchParams(window.location.search);
            const systemId = params.get('id') || 'sol';

            try {
                const [systemsResponse, shipsResponse] = await Promise.all([
                    fetch('data/systems.json'),
                    fetch('data/ships.json')
                ]);

                const systemsData = await systemsResponse.json();
                const shipsData = await shipsResponse.json();

                currentSystem = systemsData.systems.find(s => s.id === systemId);
                
                if (currentSystem) {
                    renderSystem(currentSystem);
                    renderShips(shipsData.ships.filter(s => s.system === systemId));
                }
            } catch (error) {
                console.error('Error loading system data:', error);
            }
        }

        function renderSystem(system) {
            // Update title
            document.title = `${system.name} System | Pirate Galaxy`;
            
            // Breadcrumb
            document.getElementById('breadcrumb-system').textContent = system.name;

            // Header
            document.getElementById('system-name').textContent = system.name;
            document.getElementById('system-description').textContent = system.description;
            document.getElementById('system-level').textContent = system.level;

            // Icon and color based on level
            const color = getSystemColor(system.level);
            const iconEl = document.getElementById('system-icon');
            iconEl.className = `w-20 h-20 rounded-full bg-${color}-500/20 flex items-center justify-center ${system.type === 'singularity' ? 'animate-pulse' : ''}`;

            // Stats
            const planetCount = Array.isArray(system.planets) ? system.planets.length : system.dynamicPlanets || 0;
            document.getElementById('planet-count').textContent = planetCount;
            document.getElementById('stargate-status').textContent = system.stargate ? 'Yes' : 'No';
            document.getElementById('system-type').textContent = system.type === 'singularity' ? 'Singularity' : 'Normal';
            document.getElementById('special-features').textContent = system.specialShips ? system.specialShips.length : (system.features ? system.features.length : '0');

            // Sirius special notice
            if (system.type === 'singularity') {
                document.getElementById('sirius-notice').classList.remove('hidden');
            }

            // Render planets
            if (system.planets && system.planets.length > 0) {
                renderPlanets(system.planets);
            } else {
                document.getElementById('planets-grid').classList.add('hidden');
                document.getElementById('no-planets').classList.remove('hidden');
            }

            // Update ships section title
            document.getElementById('system-ships-name').textContent = system.name;

            lucide.createIcons();
        }

        function renderPlanets(planets) {
            const grid = document.getElementById('planets-grid');
            
            grid.innerHTML = planets.map(planet => {
                const planetTypeColors = {
                    'terran': 'green',
                    'rocky': 'gray',
                    'gas': 'blue',
                    'ice': 'cyan',
                    'volcanic': 'red',
                    'desert': 'yellow',
                    'ocean': 'blue',
                    'industrial': 'orange',
                    'moon': 'gray',
                    'asteroid': 'gray',
                    'event': 'purple',
                    'rebel': 'red',
                    'hive': 'purple',
                    'wormhole': 'purple',
                    'station': 'cyan'
                };

                const color = planetTypeColors[planet.type] || 'gray';

                return `
                    <a href="planet.html?system=${currentSystem.id}&planet=${planet.id}" 
                       class="content-panel p-4 hover:border-${color}-400 transition group">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 rounded-full bg-${color}-500/20 flex items-center justify-center">
                                <i data-lucide="map-pin" class="w-5 h-5 text-${color}-400"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-${color}-300 group-hover:text-${color}-200 truncate">
                                    ${planet.name}
                                </h4>
                                <p class="text-xs text-gray-500 capitalize">${planet.type.replace('-', ' ')}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-400">Level ${planet.level}</span>
                            ${planet.hostile ? '<span class="px-2 py-0.5 bg-red-500/20 text-red-400 rounded">Hostile</span>' : ''}
                            ${planet.hasUnrest ? '<span class="px-2 py-0.5 bg-orange-500/20 text-orange-400 rounded">Unrest</span>' : ''}
                            ${planet.special ? '<span class="px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded">Special</span>' : ''}
                        </div>
                    </a>
                `;
            }).join('');

            lucide.createIcons();
        }

        function renderShips(ships) {
            const grid = document.getElementById('system-ships');
            const noShips = document.getElementById('no-ships');

            if (ships.length === 0) {
                grid.classList.add('hidden');
                noShips.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            noShips.classList.add('hidden');

            grid.innerHTML = ships.map(ship => {
                const classColors = {
                    raider: 'gray', storm: 'red', shock: 'purple', tank: 'blue',
                    engineer: 'green', defender: 'cyan', sniper: 'orange', clan: 'yellow'
                };
                const color = classColors[ship.type] || 'gray';

                return `
                    <a href="ship-detail.html?ship=${ship.id}" 
                       class="p-3 bg-gray-800/50 rounded-lg hover:bg-${color}-500/10 border border-gray-700 hover:border-${color}-500/50 transition group">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="rocket" class="w-4 h-4 text-${color}-400"></i>
                            <span class="font-semibold text-sm text-${color}-300 group-hover:text-${color}-200 truncate">
                                ${ship.name}
                            </span>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-500 capitalize">${ship.type}</span>
                            <span class="text-yellow-400">Lvl ${ship.level}</span>
                        </div>
                    </a>
                `;
            }).join('');

            lucide.createIcons();
        }

        function getSystemColor(level) {
            if (level <= 10) return 'green';
            if (level <= 30) return 'blue';
            if (level <= 40) return 'purple';
            return 'red';
        }

        function toggleView() {
            currentView = currentView === 'grid' ? 'list' : 'grid';
            const grid = document.getElementById('planets-grid');
            const icon = document.getElementById('view-icon');
            const text = document.getElementById('view-text');

            if (currentView === 'list') {
                grid.classList.remove('md:grid-cols-2', 'lg:grid-cols-3');
                grid.classList.add('grid-cols-1');
                icon.setAttribute('data-lucide', 'list');
                text.textContent = 'List View';
            } else {
                grid.classList.add('md:grid-cols-2', 'lg:grid-cols-3');
                grid.classList.remove('grid-cols-1');
                icon.setAttribute('data-lucide', 'layout-grid');
                text.textContent = 'Grid View';
            }
            lucide.createIcons();
        }

        // Initialize
        async function init() {
            await componentLoader.loadAll({
                'header': 'components/header.html',
                'footer': 'components/footer.html'
            });

            componentLoader.renderAll({
                'header-placeholder': 'header',
                'footer-placeholder': 'footer'
            });

            lucide.createIcons();
            loadSystemData();
        }

        init();
    </script>

</body>
</html>