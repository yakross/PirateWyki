<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador - Pirate Galaxy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="css/game-styles.css">
    
    <script>
        window.DISABLE_COMPONENT_LOADER = true;
        window.ADMIN_PANEL_ACTIVE = true;
    </script>
</head>
<body class="bg-gray-950">

    <!-- Header -->
    <div id="header-container"></div>
    
    <!-- Main Content -->
    <main class="min-h-screen py-12 px-4 sm:px-6">
        <div class="container mx-auto max-w-7xl">
            
            <!-- Check Admin -->
            <div id="not-admin" class="hidden">
                <div class="content-panel p-12 rounded-lg text-center">
                    <i data-lucide="lock" class="w-20 h-20 mx-auto mb-6 text-red-400"></i>
                    <h2 class="text-3xl font-bold mb-4">Acceso Denegado</h2>
                    <p class="text-gray-400 mb-6 text-lg">Solo los administradores pueden acceder a este panel</p>
                    <a href="index.html" class="hero-button px-6 py-3 inline-flex items-center gap-2">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        Volver al Inicio
                    </a>
                </div>
            </div>
            
            <!-- Admin Panel -->
            <div id="admin-content" class="hidden space-y-8">
                
                <!-- Header Section -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div>
                        <h1 class="text-4xl sm:text-5xl font-bold flex items-center gap-3 mb-2">
                            <i data-lucide="shield-alert" class="w-10 h-10 text-red-400"></i>
                            <span class="bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                                Panel Administrativo
                            </span>
                        </h1>
                        <p class="text-gray-400 text-lg">Gestiona naves, componentes, planetas y sistemas del universo</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-900/50 to-orange-900/50 border border-red-600/50 px-6 py-3 rounded-lg text-white font-bold text-sm flex items-center gap-2 animate-pulse">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                        MODO ADMINISTRADOR v3.2
                    </div>
                </div>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div class="stats-box p-6 rounded-lg text-center">
                        <i data-lucide="ship" class="w-8 h-8 mx-auto mb-3 text-blue-400"></i>
                        <div class="text-3xl font-bold text-blue-400 mb-1" id="stat-ships">0</div>
                        <div class="text-sm text-gray-400">Naves</div>
                    </div>
                    <div class="stats-box p-6 rounded-lg text-center">
                        <i data-lucide="wrench" class="w-8 h-8 mx-auto mb-3 text-green-400"></i>
                        <div class="text-3xl font-bold text-green-400 mb-1" id="stat-components">0</div>
                        <div class="text-sm text-gray-400">Componentes</div>
                    </div>
                    <div class="stats-box p-6 rounded-lg text-center">
                        <i data-lucide="globe" class="w-8 h-8 mx-auto mb-3 text-purple-400"></i>
                        <div class="text-3xl font-bold text-purple-400 mb-1" id="stat-planets">0</div>
                        <div class="text-sm text-gray-400">Planetas</div>
                    </div>
                    <div class="stats-box p-6 rounded-lg text-center">
                        <i data-lucide="network" class="w-8 h-8 mx-auto mb-3 text-yellow-400"></i>
                        <div class="text-3xl font-bold text-yellow-400 mb-1" id="stat-systems">0</div>
                        <div class="text-sm text-gray-400">Sistemas</div>
                    </div>
                    <div class="stats-box p-6 rounded-lg text-center">
                        <i data-lucide="users" class="w-8 h-8 mx-auto mb-3 text-cyan-400"></i>
                        <div class="text-3xl font-bold text-cyan-400 mb-1" id="stat-users">0</div>
                        <div class="text-sm text-gray-400">Usuarios</div>
                    </div>
                </div>
                
                <!-- Navigation Tabs -->
                <div class="flex flex-wrap gap-2 border-b border-gray-700 overflow-x-auto pb-4">
                    <button class="tab-button active px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="ships">
                        <i data-lucide="ship" class="inline w-4 h-4 mr-2"></i>Naves
                    </button>
                    <button class="tab-button px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="components">
                        <i data-lucide="wrench" class="inline w-4 h-4 mr-2"></i>Componentes
                    </button>
                    <button class="tab-button px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="planets">
                        <i data-lucide="globe" class="inline w-4 h-4 mr-2"></i>Planetas
                    </button>
                    <button class="tab-button px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="systems">
                        <i data-lucide="network" class="inline w-4 h-4 mr-2"></i>Sistemas
                    </button>
                    <button class="tab-button px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="users">
                        <i data-lucide="users" class="inline w-4 h-4 mr-2"></i>Usuarios
                    </button>
                    <button class="tab-button px-4 py-2 rounded-t-lg font-semibold transition-all" data-tab="database">
                        <i data-lucide="database" class="inline w-4 h-4 mr-2"></i>BD
                    </button>
                </div>
                
                <!-- ============================================= SHIPS TAB ============================================= -->
                <div id="ships" class="tab-content space-y-6 animate-fadeIn">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="ship" class="w-6 h-6 text-blue-400"></i>
                            Gestionar Naves
                        </h2>
                        <button onclick="toggleForm('ships')" class="hero-button px-4 py-2 inline-flex items-center gap-2 text-sm">
                            <i data-lucide="plus" class="w-5 h-5"></i>Nueva Nave
                        </button>
                    </div>
                    
                    <div id="ships-form" class="content-panel p-6 rounded-lg space-y-6 max-w-6xl hidden">
                        <h3 class="text-lg font-bold flex items-center gap-2">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i>Agregar Nueva Nave
                        </h3>

                        <!-- Panel informativo de assets -->
                        <div class="bg-slate-900/70 border border-slate-700 rounded-lg p-4 text-sm text-slate-300">
                            <p class="font-semibold mb-2 flex items-center gap-2">
                                <i data-lucide="folder" class="w-4 h-4"></i>
                                üíæ Sistema de Assets
                            </p>
                            <ul class="list-disc ml-5 space-y-1">
                                <li>Importa im√°genes 2D (PNG, WebP, SVG) para renders de naves</li>
                                <li>Importa modelos 3D (GLB/GLTF) para visualizaci√≥n interactiva</li>
                                <li>Los archivos se codifican en Base64 y se guardan en la base de datos</li>
                                <li>Alternativamente, puedes usar URLs externas directamente</li>
                            </ul>
                        </div>
                        
                        <form onsubmit="handleAddShip(event)" class="space-y-6" novalidate>
                            
                            <!-- INFORMACI√ìN B√ÅSICA -->
<!-- INFORMACI√ìN B√ÅSICA -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-green-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="info" class="w-4 h-4"></i>Informaci√≥n B√°sica
    </h4>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- üî• NOMBRE DEL COMPONENTE -->
        <div>
    <label class="block text-sm font-semibold text-gray-300 mb-2">Nombre del Componente *</label>
    <input type="text" 
           name="comp_name" 
           id="component-name" 
           required 
           minlength="3"
           placeholder="ej: Ca√±√≥n de Plasma MK-II" 
           class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
    <span class="text-xs text-gray-500">M√≠nimo 3 caracteres</span>
</div>
        
        <!-- üî• CLASE DE COMPONENTE -->
        <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-gray-300 mb-2">
                Clase de Componente
                <span class="text-gray-500 text-xs ml-2">(Categor√≠a general)</span>
            </label>
            <select id="component-class" 
                    name="component_class" 
                    required
                    class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20">
                <option value="">Selecciona una clase...</option>
                <optgroup label="‚öîÔ∏è Armas">
                    <option value="ca√±on">üî´ Ca√±√≥n</option>
                    <option value="misil">üöÄ Misil</option>
                    <option value="perforador">üî© Perforador</option>
                    <option value="rayo_termico">üî• Rayo T√©rmico</option>
                    <option value="ca√±on_largo_alcance">üéØ Ca√±√≥n de Largo Alcance</option>
                    <option value="bomba_agresion">üí£ Bomba de Agresi√≥n</option>
                    <option value="carga_ataque">‚ö° Carga de Ataque</option>
                    <option value="ataque_orbital">üõ∏ Ataque Orbital</option>
                    <option value="bomba_lapa">üß® Bomba Lapa</option>
                    <option value="haz_electrico">‚ö° Haz El√©ctrico</option>
                </optgroup>
                <optgroup label="üîß Soporte">
                    <option value="recolector">üì¶ Recolector</option>
                    <option value="reparador">üîß Reparador</option>
                    <option value="telerreparador">üì° Telereparador</option>
                    <option value="campo_reparacion">üõ†Ô∏è Campo de Reparaci√≥n</option>
                    <option value="protector">üõ°Ô∏è Protector</option>
                    <option value="resurrector">‚ù§Ô∏è Resurrector</option>
                    <option value="picador">‚õèÔ∏è Picador</option>
                    <option value="torre_reparacion">üè• Torre de Reparaci√≥n</option>
                </optgroup>
                <optgroup label="üöÄ Movilidad">
                    <option value="impulsor">üöÄ Impulsor</option>
                    <option value="acelerador">‚ö° Acelerador</option>
                    <option value="desacelerador">üêå Desacelerador</option>
                    <option value="salto_cuantico">üåÄ Salto Cu√°ntico</option>
                </optgroup>
                <optgroup label="üõ°Ô∏è Defensa">
                    <option value="escudo">üõ°Ô∏è Escudo</option>
                    <option value="se√±uelo">üé≠ Se√±uelo</option>
                    <option value="paralizador">üí• Paralizador</option>
                    <option value="se√±al_interferencia">üì° Se√±al de Interferencia</option>
                    <option value="inversor_da√±o">üîÑ Inversor de Da√±o</option>
                    <option value="droide_reflector">üîÆ Droide Reflector</option>
                    <option value="absorvedor_alcance">üåê Absorbedor de Alcance</option>
                </optgroup>
                <optgroup label="ü§ñ Drones y Especiales">
                    <option value="mira">üéØ Mira</option>
                    <option value="droide_ataque">ü§ñ Droide de Ataque</option>
                    <option value="torre_ataque">üè∞ Torre de Ataque</option>
                    <option value="mina">üí£ Mina</option>
                    <option value="trampa_magnetica">üß≤ Trampa Magn√©tica</option>
                    <option value="nube_corrosiva">‚ò†Ô∏è Nube Corrosiva</option>
                    <option value="aura_conducta">‚ú® Aura de Conducta</option>
                </optgroup>
            </select>
        </div>
        
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2">Nivel del Componente *</label>
            <input type="number" 
                   id="component-level"
                   name="comp_level" 
                   min="1" 
                   max="100" 
                   required 
                   placeholder="25" 
                   class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
        </div>
        
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2">Sistema *</label>
            <input type="text" 
                   id="component-system"
                   name="comp_system" 
                   required 
                   placeholder="sol / sirius / draconis" 
                   class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 lowercase">
        </div>
    </div>
</div>

                            <!-- CLASES DE NAVE (M√öLTIPLES) -->
                            <div class="border-b border-gray-700 pb-4">
                                <h4 class="text-sm font-bold text-purple-400 mb-3 uppercase flex items-center gap-2">
                                    <i data-lucide="layers" class="w-4 h-4"></i>Clases de Nave (Puedes seleccionar varias)
                                </h4>
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3">
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="flota" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üö¢ Flota</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="raider" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">‚öîÔ∏è Raider</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="tormenta" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">‚ö° Tormenta</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="tanque" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üõ°Ô∏è Tanque</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="ingeniera" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üîß Ingeniera</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="shock" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üí• Shock</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="sniper" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üéØ Sniper</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="minadora" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">‚õèÔ∏è Minadora</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="parsec" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üåå Parsec</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="rdx" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üí£ RDX</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="mantis" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">ü¶ó Mantis</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="neon" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üí° NeOn</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="tr" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üî∫ TR</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="arcanas" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">‚ú® Arcanas</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-2 rounded">
                                        <input type="checkbox" name="classes" value="hibridas" class="w-4 h-4 text-blue-500">
                                        <span class="text-sm">üß¨ H√≠bridas</span>
                                    </label>
                                </div>
                            </div>
                            <!-- BUFFS ADICIONALES DE LA NAVE -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-purple-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="sparkles" class="w-4 h-4"></i>Buffs Adicionales de la Nave
    </h4>
    <p class="text-xs text-gray-400 mb-3">Bonificaciones especiales que otorga la nave (afecta stats globales)</p>
    
    <div id="ship-buffs-container" class="space-y-2">
        <!-- Los buffs se agregan din√°micamente aqu√≠ -->
    </div>
    
    <button type="button" onclick="addShipBuff()" 
            class="mt-3 text-sm px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 rounded text-purple-400 border border-purple-500/50">
        <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>Agregar Buff
    </button>
</div>

                            <!-- ESTAD√çSTICAS Y RENDIMIENTO -->
                            <div class="border-b border-gray-700 pb-4">
                                <h4 class="text-sm font-bold text-green-400 mb-3 uppercase flex items-center gap-2">
                                    <i data-lucide="gauge" class="w-4 h-4"></i>Estad√≠sticas y Rendimiento
                                </h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">Armor Index *</label>
                                        <input type="number" name="armorIndex" min="0" required 
                                               placeholder="2500" 
                                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">Velocidad (Speed) *</label>
                                        <input type="number" name="speed" min="1" required 
                                               placeholder="220" 
                                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">Performance</label>
                                        <input type="text" name="performance" min="0" step="0.1" 
                                               placeholder="8.5" 
                                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                                    </div>
                                </div>
                            </div>

                            <!-- BLINDAJES CON MULTIPLICADOR Y BONO -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-cyan-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="shield" class="w-4 h-4"></i>Blindajes (Armors)
    </h4>
    <div id="armors-container" class="space-y-3">
        <!-- Primera fila de blindaje -->
        <div class="armor-row p-4 bg-gray-800/50 rounded-lg border border-gray-700">
            <div class="grid grid-cols-1 sm:grid-cols-12 gap-3 mb-3">
                <!-- Nombre -->
                <input type="text" name="armor_name_1" placeholder="Nombre del blindaje (ej: Titanium Plating)" 
                       class="sm:col-span-4 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                
                <!-- Nivel -->
                <input type="number" name="armor_level_1" placeholder="Nivel" min="1" 
                       class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                
                <!-- Multiplicador -->
                <div class="sm:col-span-2">
                    <input type="number" name="armor_multiplier_1" placeholder="Mult." min="0.1" max="10" step="0.1" value="1.0"
                           class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                    <span class="text-xs text-gray-500">Ej: 1.5</span>
                </div>
                
                <!-- Bono Extra -->
                <div class="sm:col-span-3">
                    <input type="number" name="armor_bonus_1" placeholder="Bono Extra" min="0" value="0"
                           class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                    <span class="text-xs text-gray-500">Puntos +</span>
                </div>
                
                <!-- Bot√≥n eliminar -->
                <button type="button" onclick="removeArmorField(this)" 
                        class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            
            <!-- Precios (Compra y Venta) -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="relative">
                    <label class="block text-xs text-gray-400 mb-1">üí∞ Precio de Compra</label>
                    <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="armor_price_1" placeholder="Compra" min="0" 
                           class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                </div>
                
                <div class="relative">
                    <label class="block text-xs text-gray-400 mb-1">üíµ Precio de Venta</label>
                    <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="armor_sell_1" placeholder="Venta" min="0" 
                           class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                </div>
            </div>
        </div>
    </div>
    <button type="button" onclick="addArmorField()" 
            class="mt-3 text-sm px-4 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 rounded text-cyan-400 border border-cyan-500/50">
        <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir otro blindaje
    </button>
</div>

                            <!-- SLOTS DE COMPONENTES POR TIPO -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-yellow-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="wrench" class="w-4 h-4"></i>Slots de Componentes
    </h4>
    <div class="grid grid-cols-1 gap-4">
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2">Cantidad Total de Slots *</label>
            <input type="number" name="componentSlots" min="0" max="20" required
                   placeholder="8" 
                   class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500">
            <span class="text-xs text-gray-500">Slots disponibles para equipar componentes</span>
        </div>
        
        <div id="component-slots-container" class="space-y-2 mt-3">
    <p class="text-sm text-gray-400 mb-2">Define qu√© TIPO de componente va en cada slot:</p>
    <!-- üî• PRIMER SLOT YA INCLUIDO -->
    <div class="component-slot grid grid-cols-1 sm:grid-cols-12 gap-2">
        <span class="sm:col-span-1 flex items-center justify-center text-gray-400 font-bold">1.</span>
        
        <select name="slot_component_type_1" 
                class="sm:col-span-10 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 text-sm">
            <option value="">Selecciona tipo de componente...</option>
            <optgroup label="‚öîÔ∏è Armas">
                <option value="ca√±on">üî´ Ca√±√≥n</option>
                <option value="misil">üöÄ Misil</option>
                <option value="perforador">üî© Perforador</option>
                <option value="rayo_termico">üî• Rayo T√©rmico</option>
                <option value="ca√±on_largo_alcance">üéØ Ca√±√≥n de Largo Alcance</option>
                <option value="bomba_agresion">üí£ Bomba de Agresi√≥n</option>
                <option value="carga_ataque">‚ö° Carga de Ataque</option>
                <option value="ataque_orbital">üõ∏ Ataque Orbital</option>
                <option value="bomba_lapa">üß® Bomba Lapa</option>
                <option value="haz_electrico">‚ö° Haz El√©ctrico</option>
            </optgroup>
            <optgroup label="üîß Soporte">
                <option value="recolector">üì¶ Recolector</option>
                <option value="reparador">üîß Reparador</option>
                <option value="telerreparador">üì° Telereparador</option>
                <option value="campo_reparacion">üõ†Ô∏è Campo de Reparaci√≥n</option>
                <option value="protector">üõ°Ô∏è Protector</option>
                <option value="resurrector">‚ù§Ô∏è Resurrector</option>
                <option value="picador">‚õèÔ∏è Picador</option>
                <option value="torre_reparacion">üè• Torre de Reparaci√≥n</option>
            </optgroup>
            <optgroup label="üöÄ Movilidad">
                <option value="impulsor">üöÄ Impulsor</option>
                <option value="acelerador">‚ö° Acelerador</option>
                <option value="desacelerador">üêå Desacelerador</option>
                <option value="salto_cuantico">üåÄ Salto Cu√°ntico</option>
            </optgroup>
            <optgroup label="üõ°Ô∏è Defensa">
                <option value="escudo">üõ°Ô∏è Escudo</option>
                <option value="se√±uelo">üé≠ Se√±uelo</option>
                <option value="paralizador">üí• Paralizador</option>
                <option value="se√±al_interferencia">üì° Se√±al de Interferencia</option>
                <option value="inversor_da√±o">üîÑ Inversor de Da√±o</option>
                <option value="droide_reflector">üîÆ Droide Reflector</option>
                <option value="absorvedor_alcance">üåê Absorbedor de Alcance</option>
            </optgroup>
            <optgroup label="ü§ñ Drones y Especiales">
                <option value="mira">üéØ Mira</option>
                <option value="droide_ataque">ü§ñ Droide de Ataque</option>
                <option value="torre_ataque">üè∞ Torre de Ataque</option>
                <option value="mina">üí£ Mina</option>
                <option value="trampa_magnetica">üß≤ Trampa Magn√©tica</option>
                <option value="nube_corrosiva">‚ò†Ô∏è Nube Corrosiva</option>
                <option value="aura_conducta">‚ú® Aura de Conducta</option>
            </optgroup>
        </select>
        
        <button type="button" onclick="removeComponentSlot(this)" 
                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    </div>
</div>

        <button type="button" onclick="addComponentSlot()" 
                class="text-sm px-4 py-2 bg-yellow-500/20 hover:bg-yellow-500/30 rounded text-yellow-400 border border-yellow-500/50">
            <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir slot de componente
        </button>
    </div>
</div>

                            <!-- COSTOS Y ECONOM√çA CON ICONOS INTEGRADOS -->
                            <div class="border-b border-gray-700 pb-4">
                                <h4 class="text-sm font-bold text-orange-400 mb-3 uppercase flex items-center gap-2">
                                    <i data-lucide="coins" class="w-4 h-4"></i>Costos y Econom√≠a
                                </h4>
                                
                                <!-- Costos de Compra de la Nave -->
                                <div class="mb-6">
                                    <p class="text-sm text-gray-400 mb-3 font-semibold">üõí Costos de Compra de la Nave</p>
                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                        <!-- CRIONITA -->
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                                                <img src="/assets/currencies/crionita.png" alt="Crionita" onerror="this.style.display='none'">
                                                Crionita
                                            </label>
                                            <div class="relative">
                                                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-5 h-5" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="crionita" min="0" 
                                                       placeholder="500000" 
                                                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
                                            </div>
                                        </div>

                                        <!-- ORO -->
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                                                <img src="/assets/currencies/gold.png" alt="Oro" onerror="this.style.display='none'">
                                                Oro (Premium)
                                            </label>
                                            <div class="relative">
                                                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/gold.png" alt="Oro" class="w-5 h-5" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="oro" min="0" 
                                                       placeholder="0" 
                                                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
                                            </div>
                                        </div>

                                        <!-- PRECIO DE VENTA -->
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                                                <img src="/assets/currencies/crionita.png" alt="Crionita" class="opacity-70" onerror="this.style.display='none'">
                                                Precio de Venta
                                            </label>
                                            <div class="relative">
                                                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-5 h-5 opacity-70" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="sellPrice" min="0" 
                                                       placeholder="250000" 
                                                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                                            </div>
                                            <span class="text-xs text-gray-500">Crionita recibida al vender la nave</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ranuras Cortex CON ICONOS -->
                                <div class="mb-6">
                                    <p class="text-sm text-gray-400 mb-3 font-semibold flex items-center gap-2">
                                        üß† Ranuras Cortex (Precios Escalonados)
                                        <span class="text-xs text-gray-500 font-normal">- Cada ranura tiene un precio diferente</span>
                                    </p>
                                    <div id="cortex-slots-container" class="space-y-2">
                                        <div class="cortex-slot grid grid-cols-1 sm:grid-cols-12 gap-2">
                                            <span class="sm:col-span-1 flex items-center justify-center text-cyan-400 font-bold">1.</span>
                                            
                                            <!-- COMPRA CORTEX -->
                                            <div class="sm:col-span-5 relative">
                                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="cortex_slot_price_1" placeholder="Compra (ej: 50000)" min="0"
                                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
                                            </div>
                                            
                                            <!-- VENTA CORTEX -->
                                            <div class="sm:col-span-5 relative">
                                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="cortex_slot_sell_1" placeholder="Venta (ej: 25000)" min="0"
                                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                                            </div>
                                            
                                            <button type="button" onclick="removeCortexSlot(this)" 
                                                    class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" onclick="addCortexSlot()" 
                                            class="mt-3 text-sm px-4 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 rounded text-cyan-400 border border-cyan-500/50">
                                        <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir ranura Cortex
                                    </button>
                                </div>
                                
                                <!-- Ranuras Drones CON ICONOS -->
                                <div class="mb-6">
                                    <p class="text-sm text-gray-400 mb-3 font-semibold flex items-center gap-2">
                                        ü§ñ Ranuras Drones (Precios Escalonados)
                                        <span class="text-xs text-gray-500 font-normal">- Cada ranura tiene un precio diferente</span>
                                    </p>
                                    <div id="drone-slots-container" class="space-y-2">
                                        <div class="drone-slot grid grid-cols-1 sm:grid-cols-12 gap-2">
                                            <span class="sm:col-span-1 flex items-center justify-center text-purple-400 font-bold">1.</span>
                                            
                                            <!-- COMPRA DRONE -->
                                            <div class="sm:col-span-5 relative">
                                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="drone_slot_price_1" placeholder="Compra (ej: 75000)" min="0"
                                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                                            </div>
                                            
                                            <!-- VENTA DRONE -->
                                            <div class="sm:col-span-5 relative">
                                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                                </div>
                                                <input type="number" name="drone_slot_sell_1" placeholder="Venta (ej: 37500)" min="0"
                                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                                            </div>
                                            
                                            <button type="button" onclick="removeDroneSlot(this)" 
                                                    class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" onclick="addDroneSlot()" 
                                            class="mt-3 text-sm px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 rounded text-purple-400 border border-purple-500/50">
                                        <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir ranura Drones
                                    </button>
                                </div>
                                
                                <!-- Costos Miscel√°neos AMPLIADOS -->
<div>
    <p class="text-sm text-gray-400 mb-3 font-semibold">üîß Costos Miscel√°neos</p>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Cambio de Pintura -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                Cambio de Pintura
            </label>
            <div class="relative">
                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-5 h-5" onerror="this.style.display='none'">
                </div>
                <input type="number" name="paintCost" min="0" 
                       placeholder="10000" 
                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
            </div>
        </div>
        
        <!-- Renombrar Nave -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                Renombrar Nave
            </label>
            <div class="relative">
                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-5 h-5" onerror="this.style.display='none'">
                </div>
                <input type="number" name="renameCost" min="0" 
                       placeholder="5000" 
                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
            </div>
        </div>
        
        <!-- üî• NUEVO: Configuraci√≥n de Nave -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                Configuraci√≥n de Nave
            </label>
            <div class="relative">
                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-5 h-5" onerror="this.style.display='none'">
                </div>
                <input type="number" name="configCost" min="0" 
                       placeholder="2000" 
                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
            </div>
        </div>
        
        <!-- üî• NUEVO: Costo de Reparaci√≥n -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                <img src="/assets/currencies/Energy.png" alt="Energ√≠a" class="w-4 h-4" onerror="this.style.display='none'">
                Reparaci√≥n en Hangar
            </label>
            <div class="relative">
                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                    <img src="/assets/currencies/Energy.png" alt="Energ√≠a" class="w-5 h-5" onerror="this.style.display='none'">
                </div>
                <input type="number" name="repairCost" min="0" 
                       placeholder="150" 
                       class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
            </div>
        </div>
    </div>
</div>
                            </div>

                            <!-- OBTENCI√ìN Y DESBLOQUEO - VERSI√ìN MEJORADA -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-pink-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="unlock" class="w-4 h-4"></i>Obtenci√≥n y Desbloqueo
    </h4>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- M√©todo de Obtenci√≥n -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2">¬øD√≥nde se consigue? *</label>
            <select name="obtainMethod" required 
                    onchange="toggleObtainFields('ship', this.value)"
                    class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                <option value="">Selecciona m√©todo</option>
                <option value="tienda">üõí Tienda (Shop)</option>
                <option value="mision">üìú Misi√≥n (Quest)</option>
                <option value="drop">üíÄ Drop (Enemigos)</option>
                <option value="evento">üéâ Evento Especial</option>
                <option value="planos">üìã Planos (Blueprints)</option>
                <option value="premium">‚≠ê Premium/Oro</option>
            </select>
        </div>
        
        <!-- Planos Necesarios -->
        <div>
            <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                <img src="/assets/currencies/Rank.png" alt="Nivel" class="w-4 h-4" onerror="this.style.display='none'">
                Planos Necesarios
            </label>
            <input type="number" name="blueprintsRequired" min="0" 
                   placeholder="50" 
                   class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
            <span class="text-xs text-gray-500">Cantidad para desbloquear</span>
        </div>
    </div>

    <!-- üî• NUEVA SECCI√ìN: Drop desde Enemigos -->
    <div id="ship-drop-container" class="hidden mt-4 p-4 bg-gray-800/50 rounded-lg border border-pink-500/30">
        <p class="text-sm font-semibold text-pink-400 mb-3 flex items-center gap-2">
            üíÄ Configuraci√≥n de Drop
        </p>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Sistema -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Sistema *</label>
                <select name="drop_system" 
                        onchange="updateDropPlanets('ship', this.value)"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Selecciona sistema</option>
                    <option value="sol">‚òÄÔ∏è Sistema Solar</option>
                    <option value="vega">‚≠ê Vega</option>
                    <option value="antares">üî¥ Antares</option>
                    <option value="geminis">‚ôä Geminis</option>
                    <option value="mizar">üåü Mizar</option>
                    <option value="draconis">üêâ Draconis</option>
                    <option value="sirius">üåÄ Sirius</option>
                    <option value="tau-ceti">üåå Tau Ceti</option>
                    <option value="oort">‚ùÑÔ∏è Oort</option>
                </select>
            </div>

            <!-- Planeta -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Planeta *</label>
                <select id="ship-drop-planet" name="drop_planet"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Primero elige sistema</option>
                </select>
            </div>

            <!-- Tipo de Enemigo -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Tipo de Enemigo *</label>
                <select name="drop_enemy_type"
                        onchange="updateEnemiesList('ship', this.value)"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Selecciona tipo</option>
                    <option value="mantis">ü¶ó Mantis</option>
                    <option value="imperial">‚öîÔ∏è Imperial</option>
                    <option value="arcanos_pks">‚ú® Arcanos (PKs)</option>
                    <option value="arcanos_livianos">üí® Arcanos (Livianos)</option>
                    <option value="arcanos_medianos">‚ö° Arcanos (Medianos)</option>
                    <option value="arcanos_verdes">üü¢ Arcanos (Verdes)</option>
                    <option value="arcanos_bosses">üëπ Arcanos (Bosses)</option>
                    <option value="arcanos_normales">üî∑ Arcanos (Normales)</option>
                </select>
            </div>

            <!-- Enemigo Espec√≠fico -->
            <div class="sm:col-span-2">
                <label class="block text-sm font-semibold text-gray-300 mb-2">Enemigo Espec√≠fico *</label>
                <select id="ship-drop-enemy" name="drop_enemy"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Primero elige tipo</option>
                </select>
            </div>

            <!-- Nivel del Enemigo -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                    <img src="/assets/currencies/Rank.png" alt="Nivel" class="w-4 h-4" onerror="this.style.display='none'">
                    Nivel del Enemigo
                </label>
                <input type="number" name="drop_enemy_level" 
                       placeholder="ej: 25" min="1"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
            </div>

            <!-- Probabilidad de Drop -->
            <div class="sm:col-span-2">
                <label class="block text-sm font-semibold text-gray-300 mb-2">Probabilidad de Drop (%)</label>
                <input type="number" name="drop_chance" 
                       placeholder="ej: 5.5" min="0" max="100" step="0.1"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                <span class="text-xs text-gray-500">Opcional: Indica el % de probabilidad (0.1 - 100)</span>
            </div>
        </div>
    </div>

    <!-- Campo para otros m√©todos (Misi√≥n, Evento, etc.) -->
    <div id="ship-other-location" class="mt-4">
        <label class="block text-sm font-semibold text-gray-300 mb-2">Ubicaci√≥n / Detalles</label>
        <input type="text" name="obtainLocation" 
               placeholder="Nombre de misi√≥n, evento o detalles adicionales" 
               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
        <span class="text-xs text-gray-500">Ej: "Misi√≥n: La Gran Guerra" o "Evento: Dark Orbit 2024"</span>
    </div>
</div>

                            <!-- REQUISITOS DE DESCIFRADO -->
                            <div class="border-b border-gray-700 pb-4">
                                <h4 class="text-sm font-bold text-red-400 mb-3 uppercase flex items-center gap-2">
                                    <i data-lucide="lock" class="w-4 h-4"></i>Requisitos de Descifrado (Opcional)
                                </h4>
                                <div id="requirements-container" class="space-y-3">
                                    <div class="requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3">
                                        <input type="text" name="requirement_ship_1" 
                                               placeholder="Nombre de nave/plano requerido (ej: Starblaze Scout)" 
                                               class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                                        <input type="number" name="requirement_amount_1" placeholder="Cantidad" min="1" 
                                               class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                                        <button type="button" onclick="removeRequirementField(this)" 
                                                class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                            <i data-lucide="x" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <button type="button" onclick="addRequirementField()" 
                                        class="mt-3 text-sm px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50">
                                    <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir otro requisito
                                </button>
                                <p class="text-xs text-gray-500 mt-2">üí° Para naves que requieren otras naves/planos para ser descifradas</p>
                            </div>

                            <!-- VISUALES Y DESCRIPCI√ìN CON IMPORT -->
                            <div class="border-b border-gray-700 pb-4">
                                <h4 class="text-sm font-bold text-indigo-400 mb-3 uppercase flex items-center gap-2">
                                    <i data-lucide="image" class="w-4 h-4"></i>Visuales y Descripci√≥n
                                </h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- IMAGEN 2D -->
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">üñºÔ∏è Imagen 2D</label>
                                        
                                        <!-- Preview -->
                                        <div id="image2d-preview" class="hidden mb-3 p-3 bg-gray-800 rounded-lg border border-gray-700">
                                            <img id="image2d-preview-img" src="" alt="Preview" class="max-h-32 mx-auto rounded">
                                            <p class="text-xs text-center text-gray-400 mt-2" id="image2d-filename"></p>
                                        </div>
                                        
                                        <!-- Botones de carga -->
                                        <div class="flex gap-2">
                                            <button type="button" onclick="document.getElementById('image2d-file').click()" 
                                                    class="flex-1 px-4 py-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded text-indigo-400 border border-indigo-500/50 text-sm flex items-center justify-center gap-2">
                                                <i data-lucide="upload" class="w-4 h-4"></i>
                                                Importar Archivo
                                            </button>
                                            <button type="button" onclick="clearImage2D()" 
                                                    class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 text-sm">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        <input type="file" id="image2d-file" accept="image/*" class="hidden" onchange="handleImage2DUpload(event)">
                                        <input type="hidden" name="image2D" id="image2d-data">
                                        
                                        <!-- URL alternativa -->
                                        <div class="mt-3">
                                            <label class="block text-xs text-gray-500 mb-1">O usa una URL externa:</label>
                                            <input type="text" name="image2D_url" placeholder="https://example.com/ship.png" 
                                                   class="w-full px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 text-sm">
                                        </div>
                                    </div>

                                    <!-- MODELO 3D -->
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">üéÆ Modelo 3D</label>
                                        
                                        <!-- Info del archivo -->
                                        <div id="model3d-info" class="hidden mb-3 p-3 bg-gray-800 rounded-lg border border-gray-700">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="box" class="w-5 h-5 text-indigo-400"></i>
                                                <div class="flex-1">
                                                    <p class="text-sm font-semibold text-white" id="model3d-filename"></p>
                                                    <p class="text-xs text-gray-400" id="model3d-size"></p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Botones de carga -->
                                        <div class="flex gap-2">
                                            <button type="button" onclick="document.getElementById('model3d-file').click()" 
                                                    class="flex-1 px-4 py-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded text-indigo-400 border border-indigo-500/50 text-sm flex items-center justify-center gap-2">
                                                <i data-lucide="upload" class="w-4 h-4"></i>
                                                Importar GLB/GLTF
                                            </button>
                                            <button type="button" onclick="clearModel3D()" 
                                                    class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 text-sm">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        <input type="file" id="model3d-file" accept=".glb,.gltf" class="hidden" onchange="handleModel3DUpload(event)">
                                        <input type="hidden" name="model3D" id="model3d-data">
                                        
                                        <!-- URL alternativa -->
                                        <div class="mt-3">
                                            <label class="block text-xs text-gray-500 mb-1">O usa una URL externa:</label>
                                            <input type="text" name="model3D_url" placeholder="https://example.com/ship.glb" 
                                                   class="w-full px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 text-sm">
                                        </div>
                                    </div>

                                    <div class="sm:col-span-2">
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìù Descripci√≥n *</label>
                                        <textarea name="description" rows="3" required maxlength="500" 
                                                  placeholder="Una nave de combate avanzada dise√±ada para misiones de alta velocidad..." 
                                                  class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 resize-none"></textarea>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìñ Lore / Historia</label>
                                        <textarea name="lore" rows="4" maxlength="1000" 
                                                  placeholder="Durante la Gran Guerra contra los Mantis, esta nave fue crucial..." 
                                                  class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 resize-none"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- BOTONES -->
                            <div class="flex gap-3 pt-2">
                                <button type="submit" class="hero-button px-6 py-3 inline-flex items-center gap-2">
                                    <i data-lucide="check" class="w-5 h-5"></i>
                                    Guardar Nave
                                </button>
                                <button type="button" onclick="toggleForm('ships')" class="game-nav-item px-6 py-3 inline-flex items-center gap-2">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="ships-list" class="space-y-4"></div>
                </div>
                
               <!-- ============================================= COMPONENTS TAB ============================================= -->
<div id="components" class="tab-content hidden space-y-6">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold flex items-center gap-2">
            <i data-lucide="wrench" class="w-6 h-6 text-green-400"></i>
            Gestionar Componentes
        </h2>
        <button onclick="toggleForm('components')" class="hero-button px-4 py-2 inline-flex items-center gap-2 text-sm">
            <i data-lucide="plus" class="w-5 h-5"></i>Nuevo Componente
        </button>
    </div>
    
    <div id="components-form" class="content-panel p-6 rounded-lg space-y-6 max-w-6xl hidden">
        <h3 class="text-lg font-bold flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5"></i>Agregar Nuevo Componente
        </h3>

        <!-- Panel informativo -->
        <div class="bg-slate-900/70 border border-slate-700 rounded-lg p-4 text-sm text-slate-300">
            <p class="font-semibold mb-2 flex items-center gap-2">
                <i data-lucide="info" class="w-4 h-4"></i>
                üí° Sistema de Componentes
            </p>
            <ul class="list-disc ml-5 space-y-1">
                <li>Importa im√°genes 2D y modelos 3D del componente</li>
                <li>Planos b√°sicos y arcanos tienen iconos; encriptados usan icono de lock</li>
                <li>Configura energ√≠a, cooldown, duraci√≥n y poder num√©rico</li>
            </ul>
        </div>
        
        <form onsubmit="handleAddComponent(event)" class="space-y-6" novalidate>
            
            <!-- INFORMACI√ìN B√ÅSICA -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-green-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="info" class="w-4 h-4"></i>Informaci√≥n B√°sica
                </h4>
                <div class="form-group">
  <label for="component-name">Component Name:</label>
  <input type="text" id="component-name" placeholder="e.g., Header, Navigation, Card">
</div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-medium text-gray-300 mb-2">
        Clase de Componente
        <span class="text-gray-500 text-xs ml-2">(Categor√≠a general)</span>
    </label>
    <select id="component-class" name="component_class" required
            class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20">
        <option value="">Selecciona una clase...</option>
        <optgroup label="‚öîÔ∏è Armas">
            <option value="ca√±on">üî´ Ca√±√≥n</option>
            <option value="misil">üöÄ Misil</option>
            <option value="perforador">üî© Perforador</option>
            <option value="rayo_termico">üî• Rayo T√©rmico</option>
            <option value="ca√±on_largo_alcance">üéØ Ca√±√≥n de Largo Alcance</option>
            <option value="bomba_agresion">üí£ Bomba de Agresi√≥n</option>
            <option value="carga_ataque">‚ö° Carga de Ataque</option>
            <option value="ataque_orbital">üõ∏ Ataque Orbital</option>
            <option value="bomba_lapa">üß® Bomba Lapa</option>
            <option value="haz_electrico">‚ö° Haz El√©ctrico</option>
        </optgroup>
        <optgroup label="üîß Soporte">
            <option value="recolector">üì¶ Recolector</option>
            <option value="reparador">üîß Reparador</option>
            <option value="telerreparador">üì° Telereparador</option>
            <option value="campo_reparacion">üõ†Ô∏è Campo de Reparaci√≥n</option>
            <option value="protector">üõ°Ô∏è Protector</option>
            <option value="resurrector">‚ù§Ô∏è Resurrector</option>
            <option value="picador">‚õèÔ∏è Picador</option>
            <option value="torre_reparacion">üè• Torre de Reparaci√≥n</option>
        </optgroup>
        <optgroup label="üöÄ Movilidad">
            <option value="impulsor">üöÄ Impulsor</option>
            <option value="acelerador">‚ö° Acelerador</option>
            <option value="desacelerador">üêå Desacelerador</option>
            <option value="salto_cuantico">üåÄ Salto Cu√°ntico</option>
        </optgroup>
        <optgroup label="üõ°Ô∏è Defensa">
            <option value="escudo">üõ°Ô∏è Escudo</option>
            <option value="se√±uelo">üé≠ Se√±uelo</option>
            <option value="paralizador">üí• Paralizador</option>
            <option value="se√±al_interferencia">üì° Se√±al de Interferencia</option>
            <option value="inversor_da√±o">üîÑ Inversor de Da√±o</option>
            <option value="droide_reflector">üîÆ Droide Reflector</option>
            <option value="absorvedor_alcance">üåê Absorbedor de Alcance</option>
        </optgroup>
        <optgroup label="ü§ñ Drones y Especiales">
            <option value="mira">üéØ Mira</option>
            <option value="droide_ataque">ü§ñ Droide de Ataque</option>
            <option value="torre_ataque">üè∞ Torre de Ataque</option>
            <option value="mina">üí£ Mina</option>
            <option value="trampa_magnetica">üß≤ Trampa Magn√©tica</option>
            <option value="nube_corrosiva">‚ò†Ô∏è Nube Corrosiva</option>
            <option value="aura_conducta">‚ú® Aura de Conducta</option>
        </optgroup>
    </select>
</div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Nivel del Componente *</label>
                        <input type="number" name="comp_level" min="1" max="100" required 
                               placeholder="25" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                    </div>
                    
                    <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Sistema *</label>
                <select name="comp_drop_system" 
                        onchange="updateDropPlanets('component', this.value)"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Selecciona sistema</option>
                    <option value="sol">‚òÄÔ∏è Sistema Solar</option>
                    <option value="vega">‚≠ê Vega</option>
                    <option value="antares">üî¥ Antares</option>
                    <option value="geminis">‚ôä Geminis</option>
                    <option value="mizar">üåü Mizar</option>
                    <option value="draconis">üêâ Draconis</option>
                    <option value="sirius">üåÄ Sirius</option>
                    <option value="tau-ceti">üåå Tau Ceti</option>
                    <option value="oort">‚ùÑÔ∏è Oort</option>
                </select>
            </div>
                </div>
            </div>

            <!-- CATEGOR√çA -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-purple-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="layers" class="w-4 h-4"></i>Categor√≠a del Componente
                </h4>
                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Categor√≠a *</label>
                    <select name="comp_category" required 
                            class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500">
                        <option value="">Selecciona categor√≠a</option>
                        <option value="basicos">‚öôÔ∏è B√°sicos</option>
                        <option value="tormenta">‚ö° Tormenta (Storm)</option>
                        <option value="tanque">üõ°Ô∏è Tanque (Tank)</option>
                        <option value="ingeniera">üîß Ingeniera (Engineer)</option>
                        <option value="paralizador">üí• Paralizador (Shock)</option>
                        <option value="sniper">üéØ Sniper</option>
                        <option value="minadora">‚õèÔ∏è Minadora</option>
                        <option value="evento">üéâ Evento Especial</option>
                        <option value="especial">‚ú® Especial</option>
                    </select>
                </div>
            </div>

            <!-- ESTAD√çSTICAS DE COMBATE -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-blue-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="zap" class="w-4 h-4"></i>Estad√≠sticas de Combate
                </h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- PODER -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">‚ö° Poder</label>
                        <input type="number" name="comp_power" min="0" step="0.1" 
                               placeholder="4500" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500">
                        <span class="text-xs text-gray-500">Da√±o, HP, o valor num√©rico</span>
                    </div>

                    <!-- ENERG√çA CON ICONO -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                            <img src="/assets/currencies/Energy.png" alt="Energ√≠a" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span style="display:none;">‚ö°</span>
                            Energ√≠a
                        </label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                <img src="/assets/currencies/Energy.png" alt="Energ√≠a" class="w-5 h-5" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                <span style="display:none;">‚ö°</span>
                            </div>
                            <input type="number" name="comp_energy" min="0" 
                                   placeholder="150" 
                                   class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500">
                        </div>
                        <span class="text-xs text-gray-500">Energ√≠a consumida al usar</span>
                    </div>

                    <!-- COOLDOWN -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">‚è±Ô∏è Cooldown (seg)</label>
                        <input type="number" name="comp_cooldown" min="0" step="0.1" 
                               placeholder="5.0" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500">
                        <span class="text-xs text-gray-500">Segundos para reutilizar</span>
                    </div>

                    <!-- DURACI√ìN ACTIVA -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">‚è≥ Duraci√≥n (seg)</label>
                        <input type="number" name="comp_duration" min="0" step="0.1" 
                               placeholder="10.0" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500">
                        <span class="text-xs text-gray-500">Tiempo activo del efecto</span>
                    </div>
                </div>
            </div>

            <!-- TIPO DE PLANO CON ICONOS -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-cyan-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="file-text" class="w-4 h-4"></i>Tipo de Plano
                </h4>
                
                <!-- Planos B√°sicos -->
                <div class="mb-4">
                    <p class="text-sm text-gray-400 mb-3 font-semibold">üìò Planos B√°sicos</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-gray-700">
                            <input type="radio" name="comp_blueprint_type" value="azul" class="w-4 h-4 text-cyan-500" checked>
                            <img src="/assets/blueprints/PlanoAzul.png" alt="Azul" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">üîµ</span>
                            <span class="text-sm">Azul B√°sico</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-gray-700">
                            <input type="radio" name="comp_blueprint_type" value="dorado" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/PlanoDorado.png" alt="Dorado" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">üü°</span>
                            <span class="text-sm">Dorado</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-gray-700">
                            <input type="radio" name="comp_blueprint_type" value="celeste" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/PlanoConquista.png" alt="Celeste" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">üî∑</span>
                            <span class="text-sm">Celeste (Flota)</span>
                        </label>
                    </div>
                </div>

                <!-- Planos Encriptados -->
                <div class="mb-4">
                    <p class="text-sm text-gray-400 mb-3 font-semibold">üîê Planos Encriptados</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-red-700/50">
                            <input type="radio" name="comp_blueprint_type" value="azul_encriptado" class="w-4 h-4 text-cyan-500">
                            <i data-lucide="lock" class="w-6 h-6 text-blue-500"></i>
                            <span class="text-sm">Azul Encriptado</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-red-700/50">
                            <input type="radio" name="comp_blueprint_type" value="dorado_encriptado" class="w-4 h-4 text-cyan-500">
                            <i data-lucide="lock" class="w-6 h-6 text-yellow-500"></i>
                            <span class="text-sm">Dorado Encriptado</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-red-700/50">
                            <input type="radio" name="comp_blueprint_type" value="celeste_encriptado" class="w-4 h-4 text-cyan-500">
                            <i data-lucide="lock" class="w-6 h-6 text-cyan-500"></i>
                            <span class="text-sm">Celeste Encriptado</span>
                        </label>
                    </div>
                </div>

                <!-- Planos Arcanos -->
                <div>
                    <p class="text-sm text-gray-400 mb-3 font-semibold">‚ú® Planos Arcanos</p>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-purple-700/50">
                            <input type="radio" name="comp_blueprint_type" value="arcano_duradero" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/ArcanoDuradero.png" alt="Duradero" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">üõ°Ô∏è</span>
                            <span class="text-sm">Duradero</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-purple-700/50">
                            <input type="radio" name="comp_blueprint_type" value="arcano_normal" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/ArcanoNormal.png" alt="Normal" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">‚ú®</span>
                            <span class="text-sm">Normal</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-purple-700/50">
                            <input type="radio" name="comp_blueprint_type" value="arcano_potente" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/ArcanoPotente.png" alt="Potente" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">üí•</span>
                            <span class="text-sm">Potente</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-800 p-3 rounded border border-purple-700/50">
                            <input type="radio" name="comp_blueprint_type" value="arcano_rapido" class="w-4 h-4 text-cyan-500">
                            <img src="/assets/blueprints/ArcanoRapido.png" alt="R√°pido" class="w-6 h-6" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="text-sm" style="display:none;">‚ö°</span>
                            <span class="text-sm">R√°pido</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- ECONOM√çA CON ICONOS -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-orange-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="coins" class="w-4 h-4"></i>Econom√≠a y Costos
                </h4>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                    <!-- CRIONITA COMPRA -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                            <img src="/assets/currencies/Crionita.png" alt="Crionita" onerror="this.style.display='none'">
                            Precio de Compra
                        </label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                <img src="/assets/currencies/Crionita.png" alt="Crionita" class="w-5 h-5" onerror="this.style.display='none'">
                            </div>
                            <input type="number" name="comp_price_crionita" min="0" 
                                   placeholder="150000" 
                                   class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
                        </div>
                    </div>

                    <!-- ORO COMPRA -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                            <img src="/assets/currencies/Gold.png" alt="Oro" onerror="this.style.display='none'">
                            Oro (Alternativo)
                        </label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                <img src="/assets/currencies/Gold.png" alt="Oro" class="w-5 h-5" onerror="this.style.display='none'">
                            </div>
                            <input type="number" name="comp_price_gold" min="0" 
                                   placeholder="0" 
                                   class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
                        </div>
                    </div>

                    <!-- PRECIO VENTA -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 currency-label">
                            <img src="/assets/currencies/Crionita.png" alt="Crionita" class="opacity-70" onerror="this.style.display='none'">
                            Precio de Venta
                        </label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                <img src="/assets/currencies/Crionita.png" alt="Crionita" class="w-5 h-5 opacity-70" onerror="this.style.display='none'">
                            </div>
                            <input type="number" name="comp_sell_price" min="0" 
                                   placeholder="75000" 
                                   class="w-full pl-11 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                        </div>
                    </div>
                </div>

                <!-- PLANOS -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                            <i data-lucide="file-text" class="w-4 h-4 text-blue-400"></i>
                            Planos que Dropea
                        </label>
                        <input type="number" name="comp_blueprints_item" min="0" 
                               placeholder="25" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-orange-500">
                        <span class="text-xs text-gray-500">Planos obtenidos al conseguir este componente</span>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                            <i data-lucide="lock" class="w-4 h-4 text-red-400"></i>
                            Planos para Descifrar
                        </label>
                        <input type="number" name="comp_blueprints_decrypt" min="0" 
                               placeholder="50" 
                               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                        <span class="text-xs text-gray-500">Planos necesarios (si est√° encriptado)</span>
                    </div>
                </div>
            </div>

            <!-- OBTENCI√ìN - VERSI√ìN MEJORADA PARA COMPONENTES -->
<div class="border-b border-gray-700 pb-4">
    <h4 class="text-sm font-bold text-pink-400 mb-3 uppercase flex items-center gap-2">
        <i data-lucide="map-pin" class="w-4 h-4"></i>Obtenci√≥n
    </h4>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- M√©todo de Obtenci√≥n -->
        <div class="sm:col-span-2">
            <label class="block text-sm font-semibold text-gray-300 mb-2">¬øDe d√≥nde sale? *</label>
            <select name="comp_obtain_method" required 
                    onchange="toggleObtainFields('component', this.value)"
                    class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                <option value="">Selecciona m√©todo</option>
                <option value="drop">üíÄ Drop (Enemigos)</option>
                <option value="evento">üéâ Evento Especial</option>
                <option value="tienda">üõí Tienda</option>
                <option value="planos">üìã Crafteo con Planos</option>
                <option value="mision">üìú Misi√≥n (Quest)</option>
                <option value="boss">üëπ Boss</option>
                <option value="premium">‚≠ê Premium/Oro</option>
            </select>
        </div>
    </div>

    <!-- üî• NUEVA SECCI√ìN: Drop desde Enemigos -->
    <div id="component-drop-container" class="hidden mt-4 p-4 bg-gray-800/50 rounded-lg border border-pink-500/30">
        <p class="text-sm font-semibold text-pink-400 mb-3 flex items-center gap-2">
            üíÄ Configuraci√≥n de Drop
        </p>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Sistema -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Sistema *</label>
                <select name="comp_drop_system" 
                        onchange="updateDropPlanets('component', this.value)"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Selecciona sistema</option>
                    <option value="sol">‚òÄÔ∏è Sistema Solar</option>
                    <option value="vega">‚≠ê Vega</option>
                    <option value="antares">üî¥ Antares</option>
                    <option value="geminis">‚ôä Geminis</option>
                    <option value="mizar">üåü Mizar</option>
                    <option value="draconis">üêâ Draconis</option>
                    <option value="sirius">üåÄ Sirius</option>
                    <option value="tau-ceti">üåå Tau Ceti</option>
                    <option value="oort">‚ùÑÔ∏è Oort</option>
                </select>
            </div>

            <!-- Planeta -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Planeta *</label>
                <select id="component-drop-planet" name="comp_drop_planet"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Primero elige sistema</option>
                </select>
            </div>

            <!-- Tipo de Enemigo -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Tipo de Enemigo *</label>
                <select name="comp_drop_enemy_type"
                        onchange="updateEnemiesList('component', this.value)"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Selecciona tipo</option>
                    <option value="mantis">ü¶ó Mantis</option>
                    <option value="imperial">‚öîÔ∏è Imperial</option>
                    <option value="arcanos_pks">‚ú® Arcanos (PKs)</option>
                    <option value="arcanos_livianos">üí® Arcanos (Livianos)</option>
                    <option value="arcanos_medianos">‚ö° Arcanos (Medianos)</option>
                    <option value="arcanos_verdes">üü¢ Arcanos (Verdes)</option>
                    <option value="arcanos_bosses">üëπ Arcanos (Bosses)</option>
                    <option value="arcanos_normales">üî∑ Arcanos (Normales)</option>
                </select>
            </div>

            <!-- Enemigo Espec√≠fico -->
            <div class="sm:col-span-2">
                <label class="block text-sm font-semibold text-gray-300 mb-2">Enemigo Espec√≠fico *</label>
                <select id="component-drop-enemy" name="comp_drop_enemy"
                        class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                    <option value="">Primero elige tipo</option>
                </select>
            </div>

            <!-- Nivel del Enemigo -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                    <img src="/assets/currencies/Rank.png" alt="Nivel" class="w-4 h-4" onerror="this.style.display='none'">
                    Nivel del Enemigo
                </label>
                <input type="number" name="comp_drop_enemy_level" 
                       placeholder="ej: 25" min="1"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
            </div>

            <!-- Probabilidad de Drop -->
            <div class="sm:col-span-2">
                <label class="block text-sm font-semibold text-gray-300 mb-2">Probabilidad de Drop (%)</label>
                <input type="number" name="comp_drop_chance" 
                       placeholder="ej: 5.5" min="0" max="100" step="0.1"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
                <span class="text-xs text-gray-500">Opcional: Indica el % de probabilidad (0.1 - 100)</span>
            </div>
        </div>
    </div>

    <!-- Campo para otros m√©todos -->
    <div id="component-other-location" class="mt-4">
        <label class="block text-sm font-semibold text-gray-300 mb-2">Ubicaci√≥n / Detalles</label>
        <input type="text" name="comp_obtain_location" 
               placeholder="Nombre de misi√≥n, evento, boss o detalles adicionales" 
               class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-pink-500">
    </div>
</div>

            <!-- REQUISITOS DE DESCIFRADO -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-red-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="lock" class="w-4 h-4"></i>Requisitos de Descifrado (Si est√° Encriptado)
                </h4>
                <div id="comp-requirements-container" class="space-y-3">
                    <div class="comp-requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3">
                        <input type="text" name="comp_requirement_item_1" 
                               placeholder="Nombre del plano/componente requerido" 
                               class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                        <input type="number" name="comp_requirement_amount_1" placeholder="Cantidad" min="1" 
                               class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                        <button type="button" onclick="removeCompRequirementField(this)" 
                                class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <button type="button" onclick="addCompRequirementField()" 
                        class="mt-3 text-sm px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50">
                    <i data-lucide="plus" class="inline w-4 h-4 mr-1"></i>A√±adir otro requisito
                </button>
                <p class="text-xs text-gray-500 mt-2">üí° Solo para componentes encriptados</p>
            </div>

            <!-- VISUALES (2D Y 3D) -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-indigo-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="image" class="w-4 h-4"></i>Visuales del Componente
                </h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- IMAGEN 2D -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üñºÔ∏è Imagen 2D</label>
                        
                        <!-- Preview -->
                        <div id="comp-image2d-preview" class="hidden mb-3 p-3 bg-gray-800 rounded-lg border border-gray-700">
                            <img id="comp-image2d-preview-img" src="" alt="Preview" class="max-h-24 mx-auto rounded">
                            <p class="text-xs text-center text-gray-400 mt-2" id="comp-image2d-filename"></p>
                        </div>
                        
                        <!-- Botones -->
                        <div class="flex gap-2">
                            <button type="button" onclick="document.getElementById('comp-image2d-file').click()" 
                                    class="flex-1 px-4 py-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded text-indigo-400 border border-indigo-500/50 text-sm flex items-center justify-center gap-2">
                                <i data-lucide="upload" class="w-4 h-4"></i>
                                Importar Imagen
                            </button>
                            <button type="button" onclick="clearCompImage2D()" 
                                    class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 text-sm">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <input type="file" id="comp-image2d-file" accept="image/*" class="hidden" onchange="handleCompImage2DUpload(event)">
                        <input type="hidden" name="comp_image2D" id="comp-image2d-data">
                        
                        <!-- URL alternativa -->
                        <div class="mt-3">
                            <label class="block text-xs text-gray-500 mb-1">O usa una URL externa:</label>
                            <input type="text" name="comp_image2D_url" placeholder="https://example.com/component.png" 
                                   class="w-full px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 text-sm">
                        </div>
                    </div>

                    <!-- MODELO 3D -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üéÆ Modelo 3D</label>
                        
                        <!-- Info del archivo -->
                        <div id="comp-model3d-info" class="hidden mb-3 p-3 bg-gray-800 rounded-lg border border-gray-700">
                            <div class="flex items-center gap-2">
                                <i data-lucide="box" class="w-5 h-5 text-indigo-400"></i>
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-white" id="comp-model3d-filename"></p>
                                    <p class="text-xs text-gray-400" id="comp-model3d-size"></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botones -->
                        <div class="flex gap-2">
                            <button type="button" onclick="document.getElementById('comp-model3d-file').click()" 
                                    class="flex-1 px-4 py-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded text-indigo-400 border border-indigo-500/50 text-sm flex items-center justify-center gap-2">
                                <i data-lucide="upload" class="w-4 h-4"></i>
                                Importar GLB/GLTF
                            </button>
                            <button type="button" onclick="clearCompModel3D()" 
                                    class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 text-sm">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <input type="file" id="comp-model3d-file" accept=".glb,.gltf" class="hidden" onchange="handleCompModel3DUpload(event)">
                        <input type="hidden" name="comp_model3D" id="comp-model3d-data">
                        
                        <!-- URL alternativa -->
                        <div class="mt-3">
                            <label class="block text-xs text-gray-500 mb-1">O usa una URL externa:</label>
                            <input type="text" name="comp_model3D_url" placeholder="https://example.com/component.glb" 
                                   class="w-full px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-indigo-500 text-sm">
                        </div>
                    </div>
                </div>
            </div>

            <!-- DESCRIPCI√ìN Y LORE -->
            <div class="border-b border-gray-700 pb-4">
                <h4 class="text-sm font-bold text-blue-400 mb-3 uppercase flex items-center gap-2">
                    <i data-lucide="file-text" class="w-4 h-4"></i>Descripci√≥n y Lore
                </h4>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìù Descripci√≥n *</label>
                        <textarea name="comp_description" rows="3" required maxlength="500" 
                                  placeholder="Un ca√±√≥n de plasma avanzado que dispara proyectiles de alta energ√≠a..." 
                                  class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500 resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìñ Lore / Historia</label>
                        <textarea name="comp_lore" rows="3" maxlength="1000" 
                                  placeholder="Desarrollado por los ingenieros de Vega Station durante la guerra..." 
                                  class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-blue-500 resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- BOTONES -->
            <div class="flex gap-3 pt-2">
                <button type="submit" class="hero-button px-6 py-3 inline-flex items-center gap-2">
                    <i data-lucide="check" class="w-5 h-5"></i>
                    Guardar Componente
                </button>
                <button type="button" onclick="toggleForm('components')" class="game-nav-item px-6 py-3 inline-flex items-center gap-2">
                    <i data-lucide="x" class="w-5 h-5"></i>
                    Cancelar
                </button>
            </div>
        </form>
    </div>
    
    <div id="components-list" class="space-y-4"></div>
</div>

                <!-- PLANETS TAB -->
                <div id="planets" class="tab-content hidden space-y-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="globe" class="w-6 h-6 text-purple-400"></i>
                            Gestionar Planetas
                        </h2>
                        <button onclick="toggleForm('planets')" class="hero-button px-4 py-2 inline-flex items-center gap-2 text-sm">
                            <i data-lucide="plus" class="w-5 h-5"></i>Nuevo Planeta
                        </button>
                    </div>
                    <div id="planets-form" class="content-panel p-6 rounded-lg space-y-4 max-w-3xl hidden">
                        <h3 class="text-lg font-bold">Agregar Planeta</h3>
                        <form onsubmit="handleAddPlanet(event)" class="space-y-4" novalidate>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Nombre</label><input name="name" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Sistema</label><input name="system" placeholder="sol / draconis..." required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white lowercase"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Nivel M√≠nimo</label><input type="number" name="minLevel" min="1" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Tipo</label><select name="type" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"><option value="">Selecciona</option><option value="terran">Terran</option><option value="volcanic">Volc√°nico</option><option value="ocean">Oc√©ano</option><option value="dark">Oscuro</option><option value="hive">Colmena</option><option value="fortress">Fortaleza</option></select></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Modelo 3D (URL)</label><input name="model3D" placeholder="https://..." class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Imagen 2D</label><input name="map2D" placeholder="https://..." class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Facci√≥n</label><input name="faction" placeholder="Mantis / Humanos..." class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Recursos</label><input name="resources" placeholder="Aqua Crystals..." class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div class="sm:col-span-2"><label class="block text-sm font-semibold text-gray-300 mb-2">Historia / Lore</label><textarea name="lore" rows="3" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white resize-none"></textarea></div>
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="hero-button px-4 py-2 inline-flex items-center gap-2"><i data-lucide="check" class="w-4 h-4"></i>Guardar</button>
                                <button type="button" onclick="toggleForm('planets')" class="game-nav-item px-4 py-2 inline-flex items-center gap-2"><i data-lucide="x" class="w-4 h-4"></i>Cancelar</button>
                            </div>
                        </form>
                    </div>
                    <div id="planets-list" class="space-y-4"></div>
                </div>

                <!-- SYSTEMS TAB -->
                <div id="systems" class="tab-content hidden space-y-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="network" class="w-6 h-6 text-yellow-400"></i>
                            Gestionar Sistemas
                        </h2>
                        <button onclick="toggleForm('systems')" class="hero-button px-4 py-2 inline-flex items-center gap-2 text-sm">
                            <i data-lucide="plus" class="w-5 h-5"></i>Nuevo Sistema
                        </button>
                    </div>
                    <div id="systems-form" class="content-panel p-6 rounded-lg space-y-4 max-w-3xl hidden">
                        <h3 class="text-lg font-bold">Agregar Sistema</h3>
                        <form onsubmit="handleAddSystem(event)" class="space-y-4" novalidate>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Nombre</label><input name="name" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">ID (URL)</label><input name="id" placeholder="vega / sirius..." required pattern="[a-z0-9-]+" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white lowercase"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Tipo</label><select name="type" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"><option value="">Selecciona</option><option value="normal">Normal</option><option value="singularity">Singularity</option><option value="hive">Colmena</option><option value="fortress">Fortaleza</option></select></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Nivel M√≠nimo</label><input type="number" name="minLevel" min="1" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Cantidad Planetas</label><input type="number" name="planetCount" min="0" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Facci√≥n</label><input name="faction" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div><label class="block text-sm font-semibold text-gray-300 mb-2">Imagen 2D</label><input name="mapImage" placeholder="https://..." class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white"></div>
                                <div class="sm:col-span-2"><label class="block text-sm font-semibold text-gray-300 mb-2">Historia / Descripci√≥n</label><textarea name="description" rows="3" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white resize-none"></textarea></div>
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="hero-button px-4 py-2 inline-flex items-center gap-2"><i data-lucide="check" class="w-4 h-4"></i>Guardar</button>
                                <button type="button" onclick="toggleForm('systems')" class="game-nav-item px-4 py-2 inline-flex items-center gap-2"><i data-lucide="x" class="w-4 h-4"></i>Cancelar</button>
                            </div>
                        </form>
                    </div>
                    <div id="systems-list" class="space-y-4"></div>
                </div>

                <!-- USERS TAB -->
                <div id="users" class="tab-content hidden space-y-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <i data-lucide="users" class="w-6 h-6 text-cyan-400"></i>
                        Usuarios Registrados
                    </h2>
                    <p class="text-sm text-gray-400 mb-4">‚ö†Ô∏è La edici√≥n de usuarios est√° en desarrollo. Por ahora solo puedes verlos.</p>
                    <div id="users-list" class="space-y-3"></div>
                </div>

                <!-- DATABASE TAB -->
                <div id="database" class="tab-content hidden space-y-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <i data-lucide="database" class="w-6 h-6 text-purple-400"></i>
                        Exportar/Importar Base de Datos
                    </h2>
                    <div class="content-panel p-6 bg-blue-500/10 border-blue-500/30 rounded-lg mb-6">
                        <div class="flex items-start gap-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                            <div class="text-sm text-gray-300">
                                <p class="font-semibold mb-2">üìå Importante:</p>
                                <p>Los datos creados aqu√≠ se guardan en <strong>localStorage</strong> (tu navegador). Para que aparezcan en las dem√°s p√°ginas del sitio, debes:</p>
                                <ol class="list-decimal ml-5 mt-2 space-y-1">
                                    <li>Exportar la base de datos</li>
                                    <li>Reemplazar los archivos <code>ships.json</code>, <code>planets.json</code>, etc. en la carpeta <code>/data</code></li>
                                    <li>Subir los archivos al servidor</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <button onclick="exportDatabase()" class="content-panel p-8 text-center hover:border-blue-400 transition">
                            <i data-lucide="download" class="w-12 h-12 mx-auto mb-4 text-blue-400"></i>
                            <p class="text-xl font-bold">Exportar BD</p>
                            <p class="text-sm text-gray-400 mt-2">Descargar como JSON</p>
                        </button>
                        <button onclick="importDatabase()" class="content-panel p-8 text-center hover:border-green-400 transition">
                            <i data-lucide="upload" class="w-12 h-12 mx-auto mb-4 text-green-400"></i>
                            <p class="text-xl font-bold">Importar BD</p>
                            <p class="text-sm text-gray-400 mt-2">Cargar desde JSON</p>
                        </button>
                    </div>
                    <input type="file" id="import-file" accept=".json" class="hidden">
                </div>
                
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    
    <script src="js/auth.js"></script>
    <script>
        // ============================================
        // VARIABLES GLOBALES Y CONFIGURACI√ìN
        // ============================================
        
        const COLOR_CLASSES = { 
            rarity: { 
                common: 'badge-common', 
                uncommon: 'badge-uncommon', 
                rare: 'badge-rare', 
                epic: 'badge-epic', 
                legendary: 'badge-legendary' 
            } 
        };
        
        const TYPE_LABELS = { 
            storm: 'Storm (DPS)', 
            tank: 'Tank', 
            engineer: 'Engineer', 
            shock: 'Shock' 
        };

        // Contadores globales para campos din√°micos
        let armorCounter = 1;
        let requirementCounter = 1;
        let componentSlotCounter = 1;
        let cortexSlotCounter = 1;
        let droneSlotCounter = 1;
        
// ============================================
// GESTI√ìN DE BUFFS DE LA NAVE
// ============================================

/**
 * Agrega un buff global a la nave
 */
function addShipBuff() {
    const container = document.getElementById('ship-buffs-container');
    const buffIndex = container.children.length + 1;
    
    const buffRow = document.createElement('div');
    buffRow.className = 'ship-buff-row grid grid-cols-1 sm:grid-cols-12 gap-2 mb-2';
    buffRow.innerHTML = `
        <select name="ship_buff_type_${buffIndex}" 
                class="sm:col-span-5 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
            <option value="">Selecciona tipo de buff...</option>
            <option value="velocidad">üöÄ Velocidad</option>
            <option value="defensa">üõ°Ô∏è Defensa</option>
            <option value="ataque">‚öîÔ∏è Ataque</option>
            <option value="hp">‚ù§Ô∏è HP (Puntos de Vida)</option>
            <option value="escudo">üî∞ Escudo</option>
            <option value="energia">‚ö° Energ√≠a</option>
            <option value="regeneracion">üíö Regeneraci√≥n</option>
            <option value="evasion">üí® Evasi√≥n</option>
            <option value="precision">üéØ Precisi√≥n</option>
            <option value="alcance">üìè Alcance</option>
            <option value="critico">üí• Cr√≠tico</option>
            <option value="resistencia">üí™ Resistencia</option>
            <option value="velocidad_disparo">‚ö° Velocidad de Disparo</option>
            <option value="reduccion_cooldown">‚è±Ô∏è Reducci√≥n de Cooldown</option>
            <option value="robo_vida">ü©∏ Robo de Vida</option>
            <option value="velocidad_recarga">üîã Velocidad de Recarga</option>
        </select>
        
        <div class="sm:col-span-6 flex items-center gap-2">
            <input type="number" name="ship_buff_value_${buffIndex}" 
                   placeholder="Valor (%)" min="-100" max="500" step="0.1"
                   class="flex-1 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
            <span class="text-gray-400 text-sm">%</span>
        </div>
        
        <button type="button" onclick="this.closest('.ship-buff-row').remove()" 
                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    `;
    container.appendChild(buffRow);
    lucide.createIcons();
}

        // Storage keys
        const STORAGE_KEYS = { 
            ships: 'pirate-ships-db', 
            components: 'pirate-components-db', 
            planets: 'pirate-planets-db', 
            systems: 'pirate-systems-db' 
        };
        

// ============================================
// DATOS PREDEFINIDOS DEL JUEGO
// ============================================

const GAME_DATA = {
    systems: {        vega: {
            name: "Vega",
            planets: ["Kalabesh", "Axiom", "Colossus", "Lyris", "Aurora"]
        },
        antares: {
            name: "Antares",
            planets: ["Terasa", "Lustra"]
        },
        geminis: { // Nota: Usamos 'geminis' para que coincida con tu lista
            name: "Geminis",
            planets: ["Prosperus", "Commerce Central", "Technatoria"]
        },
        mizar: {
            name: "Mizar",
            planets: ["Baumar", "Molikar"]
        },
        sol: {
            name: "Sistema Solar",
            planets: ["Marte", "La Luna", "La Tierra", "Planetoide AX-03", "Planetoide BX-12", "Planetoide CX-09", "Planetoide DY-52", "Planetoide EZ-35", "Planetoide FX-46", "Planetoide GW-75"]
        },
        draconis: {
            name: "Draconis",
            planets: ["Gazica", "Colmena Mantis"]
        },
        sirius: {
            name: "Singularidad Sirius",
            planets: ["Primer Anillo", "Segundo Anillo", "Tercer Anillo", "Cuarto Anillo", "Quinto Anillo"]
        },
        'tau-ceti': {
            name: "Tau Ceti",
            planets: ["Venar", "Tierra en Conflicto", "Calon"]
        },
        oort: {
            name: "Oort",
            planets: ["Erebos"]
        }
    },
    enemies: {
        mantis: [
            "Drone Mantis", "Explorador Mantis", "Explorador Raro Mantis", "Centinela Mantis", "Exterminador Mantis", "Comandante Exterminador Mantis", "Exterminador Raro Mantis", "Torreta Lanzacohetes Mantis", "Depredador Mantis", "Recolectora Mantis", "Interceptador Mantis", "Reparadora Mantis", "Depredador Raro Mantis", "Pirata Mantis", "Pirata Raro Mantis", "Comandante Centinela Mantis", "Comandante Pirata Mantis", "Comandante Depredador Mantis", "Torreta Paralizadora Mantis", "Comandante Pirata Raro Mantis", "Barbaro Mantis", "Barbaro Raro Mantis", "Frenzoid Mantis", "Frenzoid Raro Mantis", "Misilera Mantis", "Misilera Raro Mantis", "Comandante Misilera Mantis", "Parasito Mantis", "Parasito Raro Mantis", "Parasito Comandante Mantis", "Resurrector Mantis", "Detonador Mantis", "Pyro Mantis", "Pyro Raro Mantis", "Paralizador Mantis", "Paralizador Raro Mantis", "Transportador Mantis", "Asesino Mantis", "Asesino Raro Mantis", "Francotirador Mantis", "Reparacha Mantis", "Saboteador Mantis", "Saboteador Raro Mantis", "Minador Mantis", "Minador Raro Mantis", "Dron de Ataque Mantis", "Striker Mantis", "Endurer Mantis", "Balter Mantis", "Skirmisher Mantis", "Grifter Mantis", "Berserker Mantis", "Runner Mantis", "Torre de corrupci√≥n Mantis", "Torre de largo alcance Mantis", "CENTINELA Mantis"
        ],
        imperial: [            "Recolectora Imperial", "Comandante Imperial", "Comandante Raro Imperial", "Francotirador Imperial", "Francotirador Raro Imperial", "Nodo de reparacion Imperial", "Droide de ataque Imperial", "Torreta lanzamisiles Imperial", "Torreta paralizadora Imperial", "Reparacha Imperial", "Resurrector Imperial", "Centurion Imperial", "Centuri√≥n Commander Imperial", "Curtius Imperial", "Hastatus Imperial", "Triarius Imperial", "Veles Imperial"
        ],
        arcanos: {
            pks: ["Khons Arcano", "Ammon Arcano", "Shysis Arcano"],
            livianos: ["Horus Arcano", "Isis Arcano", "Phyrus Arcano"],
            medianos: ["Abasis Arcano", "Odion Arcano", "Ignomes Arcano"],
            verdes: ["Comandante Ignomes Arcano", "Anubis Arcano", "Keops Arcano", "Osiris Arcano"],
            bosses: ["Giza Arcano", "Soris Arcano", "Amarna Arcano"],
            normales: ["Blinker Arcano", "Defender Arcano", "Baiter Arcano", "Hathor Arcano", "Reparacha Arcano", "Ra Arcano", "Sejmet Arcano", "Seth Arcano", "Sobek Arcano"]
        }
    }
};

// ============================================
// GESTI√ìN DE OBTENCI√ìN Y DROPS - MEJORADO
// ============================================

/**
 * Muestra/oculta campos seg√∫n el m√©todo de obtenci√≥n
 * @param {string} formType - 'ship' o 'component'
 * @param {string} method - m√©todo seleccionado
 */
function toggleObtainFields(formType, method) {
    const dropContainer = document.getElementById(`${formType}-drop-container`);
    const otherLocation = document.getElementById(`${formType}-other-location`);
    
    if (method === 'drop' || method === 'boss') {
        dropContainer.classList.remove('hidden');
        otherLocation.classList.add('hidden');
    } else {
        dropContainer.classList.add('hidden');
        otherLocation.classList.remove('hidden');
    }
}

/**
 * Actualiza la lista de planetas seg√∫n el sistema seleccionado
 * @param {string} formType - 'ship' o 'component'
 * @param {string} systemKey - clave del sistema (ej: 'vega')
 */
function updateDropPlanets(formType, systemKey) {
    const selectId = formType === 'ship' ? 'ship-drop-planet' : 'component-drop-planet';
    const planetSelect = document.getElementById(selectId);
    
    // Limpiar opciones
    planetSelect.innerHTML = '<option value="">Selecciona un planeta</option>';
    
    if (systemKey && GAME_DATA.systems[systemKey]) {
        const planets = GAME_DATA.systems[systemKey].planets;
        planets.forEach(planetName => {
            const option = document.createElement('option');
            option.value = planetName;
            option.textContent = planetName;
            planetSelect.appendChild(option);
        });
    }
}

/**
 * Actualiza la lista de enemigos seg√∫n el tipo seleccionado
 * @param {string} formType - 'ship' o 'component'
 * @param {string} enemyType - tipo de enemigo (ej: 'mantis', 'arcanos_pks')
 */
function updateEnemiesList(formType, enemyType) {
    const selectId = formType === 'ship' ? 'ship-drop-enemy' : 'component-drop-enemy';
    const enemySelect = document.getElementById(selectId);
    
    // Limpiar opciones
    enemySelect.innerHTML = '<option value="">Selecciona enemigo</option>';
    
    let enemies = [];
    
    // Obtener lista seg√∫n tipo
    if (enemyType === 'mantis') {
        enemies = GAME_DATA.enemies.mantis;
    } else if (enemyType === 'imperial') {
        enemies = GAME_DATA.enemies.imperial;
    } else if (enemyType.startsWith('arcanos_')) {
        const subType = enemyType.replace('arcanos_', '');
        enemies = GAME_DATA.enemies.arcanos[subType] || [];
    }
    
    // Llenar select
    enemies.forEach(enemyName => {
        const option = document.createElement('option');
        option.value = enemyName;
        option.textContent = enemyName;
        enemySelect.appendChild(option);
    });
    
    if (enemies.length === 0) {
        enemySelect.innerHTML = '<option value="">No hay enemigos disponibles</option>';
    }
}

        // ============================================
        // UTILIDADES
        // ============================================
        
        function generateUniqueId(prefix = '') { 
            return `${prefix}${Date.now()}-${Math.random().toString(36).slice(2, 10)}`; 
        }
        
        function sanitizeText(text = '') { 
            const div = document.createElement('div'); 
            div.textContent = text; 
            return div.innerHTML; 
        }
        
        function safeNumber(value, fallback = 0) { 
            const num = Number(value); 
            return Number.isFinite(num) ? num : fallback; 
        }
        
        function formatNumber(num) {
            return Number(num).toLocaleString('es-ES');
        }

        function updatePlanetsSelect(systemKey, selectId) {
    const planetSelect = document.getElementById(selectId);
    planetSelect.innerHTML = '<option value="">Selecciona un planeta</option>'; // Limpiar opciones
    
    if (systemKey && GAME_DATA.systems[systemKey]) {
        const planets = GAME_DATA.systems[systemKey].planets;
        planets.forEach(planetName => {
            const option = document.createElement('option');
            option.value = planetName;
            option.textContent = planetName;
            planetSelect.appendChild(option);
        });
    }
}

function toggleEnemyDropFields(formType, selectedMethod) {
    const containerId = `${formType}-drop-location-container`;
    const container = document.getElementById(containerId);
    if (!container) return;

    if (selectedMethod === 'drop' || selectedMethod === 'boss') {
        container.classList.remove('hidden');
    } else {
        container.classList.add('hidden');
    }
}

function populateEnemySelect(selectId) {
    const enemySelect = document.getElementById(selectId);
    enemySelect.innerHTML = '<option value="">Selecciona un enemigo</option>';

    // Funci√≥n para a√±adir un grupo de enemigos
    const addEnemyGroup = (groupName, enemies) => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = groupName;
        enemies.forEach(enemy => {
            const option = document.createElement('option');
            option.value = enemy;
            option.textContent = enemy;
            optgroup.appendChild(option);
        });
        enemySelect.appendChild(optgroup);
    };

    addEnemyGroup('Mantis', GAME_DATA.enemies.mantis);
    addEnemyGroup('Imperial', GAME_DATA.enemies.imperial);
    
    // Para Arcanos, que tienen subcategor√≠as
    Object.keys(GAME_DATA.enemies.arcanos).forEach(subCategory => {
        const groupName = `Arcanos (${subCategory.charAt(0).toUpperCase() + subCategory.slice(1)})`;
        addEnemyGroup(groupName, GAME_DATA.enemies.arcanos[subCategory]);
    });}

        // üî• FUNCIONES DE MANEJO DE ARCHIVOS
        function handleImage2DUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validar tipo
            if (!file.type.startsWith('image/')) {
                notify('El archivo debe ser una imagen (PNG, JPG, WebP, SVG)', 'error');
                return;
            }
            
            // Validar tama√±o (5MB m√°ximo)
            if (file.size > 5 * 1024 * 1024) {
                notify('La imagen no debe superar 5MB', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                document.getElementById('image2d-data').value = base64;
                document.getElementById('image2d-preview-img').src = base64;
                document.getElementById('image2d-filename').textContent = file.name;
                document.getElementById('image2d-preview').classList.remove('hidden');
                notify('Imagen cargada correctamente', 'success');
            };
            reader.readAsDataURL(file);
        }

        function handleModel3DUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validar extensi√≥n
            const validExtensions = ['.glb', '.gltf'];
            const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
            if (!validExtensions.includes(fileExtension)) {
                notify('El archivo debe ser GLB o GLTF', 'error');
                return;
            }
            
            // Validar tama√±o (20MB m√°ximo)
            if (file.size > 20 * 1024 * 1024) {
                notify('El modelo no debe superar 20MB', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                document.getElementById('model3d-data').value = base64;
                document.getElementById('model3d-filename').textContent = file.name;
                document.getElementById('model3d-size').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                document.getElementById('model3d-info').classList.remove('hidden');
                notify('Modelo 3D cargado correctamente', 'success');
            };
            reader.readAsDataURL(file);
        }

        function clearImage2D() {
            document.getElementById('image2d-file').value = '';
            document.getElementById('image2d-data').value = '';
            document.getElementById('image2d-preview').classList.add('hidden');
            notify('Imagen eliminada', 'info');
        }

        function clearModel3D() {
            document.getElementById('model3d-file').value = '';
            document.getElementById('model3d-data').value = '';
            document.getElementById('model3d-info').classList.add('hidden');
            notify('Modelo 3D eliminado', 'info');
        }
        
        function notify(msg, type = 'info') {
            const colors = { 
                success: 'bg-green-500', 
                error: 'bg-red-500', 
                warning: 'bg-yellow-500', 
                info: 'bg-blue-500' 
            };
            
            let container = document.getElementById('notifications');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notifications';
                container.className = 'fixed top-4 right-4 z-50 space-y-2 max-w-sm';
                document.body.appendChild(container);
            }
            
            const notification = document.createElement('div');
            notification.className = `${colors[type]} text-white px-5 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fadeIn`;
            notification.innerHTML = `
                <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
                <span>${msg}</span>
            `;
            
            container.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // ============================================
// FUNCI√ìN PARA ICONOS DE CLASE DE COMPONENTE
// ============================================

function getComponentClassIcon(componentClass) {
    const icons = {
        'ca√±on': 'üî´',
        'misil': 'üöÄ',
        'perforador': 'üî©',
        'rayo_termico': 'üî•',
        'ca√±on_largo_alcance': 'üéØ',
        'bomba_agresion': 'üí£',
        'carga_ataque': '‚ö°',
        'ataque_orbital': 'üõ∏',
        'bomba_lapa': 'üß®',
        'haz_electrico': '‚ö°',
        'recolector': 'üì¶',
        'reparador': 'üîß',
        'telerreparador': 'üì°',
        'campo_reparacion': 'üõ†Ô∏è',
        'protector': 'üõ°Ô∏è',
        'resurrector': '‚ù§Ô∏è',
        'picador': '‚õèÔ∏è',
        'torre_reparacion': 'üè•',
        'impulsor': 'üöÄ',
        'acelerador': '‚ö°',
        'desacelerador': 'üêå',
        'salto_cuantico': 'üåÄ',
        'escudo': 'üõ°Ô∏è',
        'se√±uelo': 'üé≠',
        'paralizador': 'üí•',
        'se√±al_interferencia': 'üì°',
        'inversor_da√±o': 'üîÑ',
        'droide_reflector': 'üîÆ',
        'absorvedor_alcance': 'üåê',
        'mira': 'üéØ',
        'droide_ataque': 'ü§ñ',
        'torre_ataque': 'üè∞',
        'mina': 'üí£',
        'trampa_magnetica': 'üß≤',
        'nube_corrosiva': '‚ò†Ô∏è',
        'aura_conducta': '‚ú®'
    };
    return icons[componentClass] || '‚öôÔ∏è';
}

// ============================================
// GESTI√ìN DE BUFFS EN BLINDAJES
// ============================================

/**
 * Agrega un buff a un blindaje espec√≠fico
 */
function addArmorBuff(armorIndex) {
    const container = document.querySelector(`.armor-buffs-container[data-armor-index="${armorIndex}"]`);
    if (!container) return;
    
    const buffIndex = container.children.length + 1;
    const buffRow = document.createElement('div');
    buffRow.className = 'buff-row grid grid-cols-1 sm:grid-cols-12 gap-2 mb-2';
    buffRow.innerHTML = `
        <select name="armor_${armorIndex}_buff_type_${buffIndex}" 
                class="sm:col-span-5 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
            <option value="">Tipo de buff...</option>
            <option value="velocidad">üöÄ Velocidad</option>
            <option value="defensa">üõ°Ô∏è Defensa</option>
            <option value="ataque">‚öîÔ∏è Ataque</option>
            <option value="evasion">üí® Evasi√≥n</option>
            <option value="resistencia">üí™ Resistencia</option>
            <option value="escudo">üî∞ Escudo</option>
            <option value="energia">‚ö° Energ√≠a</option>
        </select>
        
        <div class="sm:col-span-6 flex items-center gap-2">
            <input type="number" name="armor_${armorIndex}_buff_value_${buffIndex}" 
                   placeholder="Valor (%)" min="-100" max="100" step="0.1"
                   class="flex-1 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
            <span class="text-gray-400">%</span>
        </div>
        
        <button type="button" onclick="this.closest('.buff-row').remove()" 
                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    `;
    container.appendChild(buffRow);
    lucide.createIcons();
}

/**
 * Llena los selectores de componentes con los componentes existentes
 */
function populateComponentSelects() {
    const components = DB.components();
    const selects = document.querySelectorAll('.component-select');
    
    selects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = '<option value="">Selecciona un componente...</option>';
        
        if (components.length === 0) {
            const option = document.createElement('option');
            option.value = '';
            option.textContent = '‚ö†Ô∏è No hay componentes creados a√∫n';
            option.disabled = true;
            select.appendChild(option);
            return;
        }
        
        // Agrupar por categor√≠a
        const groupedComponents = {};
        components.forEach(comp => {
            const category = comp.category || 'sin_categoria';
            if (!groupedComponents[category]) {
                groupedComponents[category] = [];
            }
            groupedComponents[category].push(comp);
        });
        
        // Crear optgroups
        Object.keys(groupedComponents).forEach(category => {
            const categoryLabels = {
                basicos: '‚öôÔ∏è B√°sicos',
                tormenta: '‚ö° Tormenta',
                tanque: 'üõ°Ô∏è Tanque',
                ingeniera: 'üîß Ingeniera',
                paralizador: 'üí• Paralizador',
                sniper: 'üéØ Sniper',
                minadora: '‚õèÔ∏è Minadora',
                evento: 'üéâ Evento',
                especial: '‚ú® Especial',
                sin_categoria: 'üì¶ Sin Categor√≠a'
            };
            
            const optgroup = document.createElement('optgroup');
            optgroup.label = categoryLabels[category] || category;
            
            groupedComponents[category].forEach(comp => {
                const option = document.createElement('option');
                option.value = comp.id;
                option.textContent = `${comp.name} (Lv${comp.level})`;
                if (comp.id === currentValue) option.selected = true;
                optgroup.appendChild(option);
            });
            
            select.appendChild(optgroup);
        });
    });
}

        // ============================================
        // GESTI√ìN DE BLINDAJES CON ICONOS
        // ============================================
        
        function addArmorField() {
    armorCounter++;
    const container = document.getElementById('armors-container');
    const newRow = document.createElement('div');
    newRow.className = 'armor-row p-4 bg-gray-800/50 rounded-lg border border-gray-700 mb-3';
    newRow.innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-12 gap-3 mb-3">
            <input type="text" name="armor_name_${armorCounter}" placeholder="Nombre del blindaje" 
                   class="sm:col-span-4 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
            
            <input type="number" name="armor_level_${armorCounter}" placeholder="Nivel" min="1" 
                   class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
            
            <div class="sm:col-span-2">
                <input type="number" name="armor_multiplier_${armorCounter}" placeholder="Mult." min="0.1" max="10" step="0.1" value="1.0"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                <span class="text-xs text-gray-500">Ej: 1.5</span>
            </div>
            
            <div class="sm:col-span-3">
                <input type="number" name="armor_bonus_${armorCounter}" placeholder="Bono" min="0" value="0"
                       class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                <span class="text-xs text-gray-500">Puntos +</span>
            </div>
            
            <button type="button" onclick="removeArmorField(this)" 
                    class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="relative">
                <label class="block text-xs text-gray-400 mb-1">üí∞ Compra</label>
                <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                </div>
                <input type="number" name="armor_price_${armorCounter}" placeholder="0" min="0" 
                       class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
            </div>
            
            <div class="relative">
                <label class="block text-xs text-gray-400 mb-1">üíµ Venta</label>
                <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                </div>
                <input type="number" name="armor_sell_${armorCounter}" placeholder="0" min="0" 
                       class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
            </div>
        </div>
    `;
    container.appendChild(newRow);
    lucide.createIcons();
}
        
        function removeArmorField(button) {
            button.closest('.armor-row').remove();
        }
        
        // ============================================
        // GESTI√ìN DE REQUISITOS
        // ============================================
        
        function addRequirementField() {
            requirementCounter++;
            const container = document.getElementById('requirements-container');
            const newRow = document.createElement('div');
            newRow.className = 'requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3';
            newRow.innerHTML = `
                <input type="text" name="requirement_ship_${requirementCounter}" 
                       placeholder="Nombre de nave/plano requerido" 
                       class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                <input type="number" name="requirement_amount_${requirementCounter}" placeholder="Cantidad" min="1" 
                       class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                <button type="button" onclick="removeRequirementField(this)" 
                        class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
            container.appendChild(newRow);
            lucide.createIcons();
        }
        
        function removeRequirementField(button) {
            button.closest('.requirement-row').remove();
        }
        
        // ============================================
        // GESTI√ìN DE SLOTS DE COMPONENTES
        // ============================================
        
        function addComponentSlot() {
    componentSlotCounter++;
    const container = document.getElementById('component-slots-container');
    const newSlot = document.createElement('div');
    newSlot.className = 'component-slot grid grid-cols-1 sm:grid-cols-12 gap-2 mb-2';
    newSlot.innerHTML = `
        <span class="sm:col-span-1 flex items-center justify-center text-gray-400 font-bold">${componentSlotCounter}.</span>
        
        <select name="slot_component_type_${componentSlotCounter}" 
                class="sm:col-span-10 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 text-sm">
            <option value="">Selecciona tipo de componente...</option>
            <optgroup label="‚öîÔ∏è Armas">
                <option value="ca√±on">üî´ Ca√±√≥n</option>
                <option value="misil">üöÄ Misil</option>
                <option value="perforador">üî© Perforador</option>
                <option value="rayo_termico">üî• Rayo T√©rmico</option>
                <option value="ca√±on_largo_alcance">üéØ Ca√±√≥n de Largo Alcance</option>
                <option value="bomba_agresion">üí£ Bomba de Agresi√≥n</option>
                <option value="carga_ataque">‚ö° Carga de Ataque</option>
                <option value="ataque_orbital">üõ∏ Ataque Orbital</option>
                <option value="bomba_lapa">üß® Bomba Lapa</option>
                <option value="haz_electrico">‚ö° Haz El√©ctrico</option>
            </optgroup>
            <optgroup label="üîß Soporte">
                <option value="recolector">üì¶ Recolector</option>
                <option value="reparador">üîß Reparador</option>
                <option value="telerreparador">üì° Telereparador</option>
                <option value="campo_reparacion">üõ†Ô∏è Campo de Reparaci√≥n</option>
                <option value="protector">üõ°Ô∏è Protector</option>
                <option value="resurrector">‚ù§Ô∏è Resurrector</option>
                <option value="picador">‚õèÔ∏è Picador</option>
                <option value="torre_reparacion">üè• Torre de Reparaci√≥n</option>
            </optgroup>
            <optgroup label="üöÄ Movilidad">
                <option value="impulsor">üöÄ Impulsor</option>
                <option value="acelerador">‚ö° Acelerador</option>
                <option value="desacelerador">üêå Desacelerador</option>
                <option value="salto_cuantico">üåÄ Salto Cu√°ntico</option>
            </optgroup>
            <optgroup label="üõ°Ô∏è Defensa">
                <option value="escudo">üõ°Ô∏è Escudo</option>
                <option value="se√±uelo">üé≠ Se√±uelo</option>
                <option value="paralizador">üí• Paralizador</option>
                <option value="se√±al_interferencia">üì° Se√±al de Interferencia</option>
                <option value="inversor_da√±o">üîÑ Inversor de Da√±o</option>
                <option value="droide_reflector">üîÆ Droide Reflector</option>
                <option value="absorvedor_alcance">üåê Absorbedor de Alcance</option>
            </optgroup>
            <optgroup label="ü§ñ Drones y Especiales">
                <option value="mira">üéØ Mira</option>
                <option value="droide_ataque">ü§ñ Droide de Ataque</option>
                <option value="torre_ataque">üè∞ Torre de Ataque</option>
                <option value="mina">üí£ Mina</option>
                <option value="trampa_magnetica">üß≤ Trampa Magn√©tica</option>
                <option value="nube_corrosiva">‚ò†Ô∏è Nube Corrosiva</option>
                <option value="aura_conducta">‚ú® Aura de Conducta</option>
            </optgroup>
        </select>
        
        <button type="button" onclick="removeComponentSlot(this)" 
                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    `;
    container.appendChild(newSlot);
    lucide.createIcons();
}
        
        function removeComponentSlot(button) {
            button.closest('.component-slot').remove();
            renumberSlots();
        }
        
        function renumberSlots() {
    const slots = document.querySelectorAll('.component-slot');
    slots.forEach((slot, index) => {
        const span = slot.querySelector('span');
        const select = slot.querySelector('select');
        
        if (span) span.textContent = `${index + 1}.`;
        
        // Actualizar el name del select para que coincida con el √≠ndice
        if (select) {
            const oldName = select.getAttribute('name');
            if (oldName) {
                const newName = `slot_component_type_${index + 1}`;
                select.setAttribute('name', newName);
            }
        }
    });
    componentSlotCounter = slots.length;
}
        
        // ============================================
        // GESTI√ìN DE RANURAS CORTEX CON ICONOS
        // ============================================
        
        function addCortexSlot() {
            cortexSlotCounter++;
            const container = document.getElementById('cortex-slots-container');
            const newSlot = document.createElement('div');
            newSlot.className = 'cortex-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
            newSlot.innerHTML = `
                <span class="sm:col-span-1 flex items-center justify-center text-cyan-400 font-bold">${cortexSlotCounter}.</span>
                
                <div class="sm:col-span-5 relative">
                    <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="cortex_slot_price_${cortexSlotCounter}" placeholder="Compra" min="0"
                           class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
                </div>
                
                <div class="sm:col-span-5 relative">
                    <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="cortex_slot_sell_${cortexSlotCounter}" placeholder="Venta" min="0"
                           class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                </div>
                
                <button type="button" onclick="removeCortexSlot(this)" 
                        class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
            container.appendChild(newSlot);
            lucide.createIcons();
        }
        
        function removeCortexSlot(button) {
            button.closest('.cortex-slot').remove();
            renumberCortexSlots();
        }
        
        function renumberCortexSlots() {
            const slots = document.querySelectorAll('.cortex-slot');
            slots.forEach((slot, index) => {
                const span = slot.querySelector('span');
                if (span) span.textContent = `${index + 1}.`;
            });
            cortexSlotCounter = slots.length;
        }
        
        // ============================================
        // GESTI√ìN DE RANURAS DRONES CON ICONOS
        // ============================================
        
        function addDroneSlot() {
            droneSlotCounter++;
            const container = document.getElementById('drone-slots-container');
            const newSlot = document.createElement('div');
            newSlot.className = 'drone-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
            newSlot.innerHTML = `
                <span class="sm:col-span-1 flex items-center justify-center text-purple-400 font-bold">${droneSlotCounter}.</span>
                
                <div class="sm:col-span-5 relative">
                    <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="drone_slot_price_${droneSlotCounter}" placeholder="Compra" min="0"
                           class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                </div>
                
                <div class="sm:col-span-5 relative">
                    <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                        <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                    </div>
                    <input type="number" name="drone_slot_sell_${droneSlotCounter}" placeholder="Venta" min="0"
                           class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                </div>
                
                <button type="button" onclick="removeDroneSlot(this)" 
                        class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
            container.appendChild(newSlot);
            lucide.createIcons();
        }
        
        function removeDroneSlot(button) {
            button.closest('.drone-slot').remove();
            renumberDroneSlots();
        }
        
        function renumberDroneSlots() {
            const slots = document.querySelectorAll('.drone-slot');
            slots.forEach((slot, index) => {
                const span = slot.querySelector('span');
                if (span) span.textContent = `${index + 1}.`;
            });
            droneSlotCounter = slots.length;
        }
        
        // ============================================
        // GESTI√ìN DE BASE DE DATOS
        // ============================================
        
        const DB = {
            ships: () => readCollection(STORAGE_KEYS.ships),
            components: () => readCollection(STORAGE_KEYS.components),
            planets: () => readCollection(STORAGE_KEYS.planets),
            systems: () => readCollection(STORAGE_KEYS.systems),
            save(type, data) {
                localStorage.setItem(STORAGE_KEYS[type], JSON.stringify(data));
                updateStats();
                window.dispatchEvent(new StorageEvent('storage', { 
                    key: STORAGE_KEYS[type], 
                    newValue: JSON.stringify(data) 
                }));
            }
        };
        
        function readCollection(key) {
            try {
                const raw = localStorage.getItem(key);
                return raw ? JSON.parse(raw) : [];
            } catch { 
                return []; 
            }
        }
        
        function countUsers() {
            let count = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key?.startsWith('pirate-user-') && key !== 'pirate-user') {
                    try { 
                        if (JSON.parse(localStorage.getItem(key))?.id) count++; 
                    } catch {}
                }
            }
            return count;
        }
        
        function updateStats() {
            document.getElementById('stat-ships').textContent = DB.ships().length;
            document.getElementById('stat-components').textContent = DB.components().length;
            document.getElementById('stat-planets').textContent = DB.planets().length;
            document.getElementById('stat-systems').textContent = DB.systems().length;
            document.getElementById('stat-users').textContent = countUsers();
        }
        
        // ============================================
        // GESTI√ìN DE FORMULARIOS
        // ============================================
        
        function toggleForm(type) {
            const form = document.getElementById(`${type}-form`);
            if (!form) return;
            
            const isHidden = form.classList.contains('hidden');
            form.classList.toggle('hidden');
            
            if (isHidden) {
                // Resetear contadores
                armorCounter = 1;
                requirementCounter = 1;
                componentSlotCounter = 1;
                cortexSlotCounter = 1;
                droneSlotCounter = 1;
                
                // Resetear formulario
                form.querySelectorAll('form').forEach(f => f.reset());
                
                // Limpiar previews de im√°genes
                clearImage2D();
                clearModel3D();
                
                // Limpiar buffs de la nave
const shipBuffsContainer = document.getElementById('ship-buffs-container');
if (shipBuffsContainer) {
    shipBuffsContainer.innerHTML = '';
}

                // Limpiar campos din√°micos de blindajes
                const armorsContainer = document.getElementById('armors-container');
                if (armorsContainer) {
                    armorsContainer.innerHTML = `
                        <div class="armor-row grid grid-cols-1 sm:grid-cols-12 gap-3">
                            <input type="text" name="armor_name_1" placeholder="Nombre del blindaje (ej: Titanium Plating)" 
                                   class="sm:col-span-5 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            <input type="number" name="armor_level_1" placeholder="Nivel" min="1" 
                                   class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            
                            <div class="sm:col-span-2 relative">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="armor_price_1" placeholder="Compra" min="0" 
                                       class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            </div>
                            
                            <div class="sm:col-span-2 relative">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="armor_sell_1" placeholder="Venta" min="0" 
                                       class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                            </div>
                            
                            <button type="button" onclick="removeArmorField(this)" 
                                    class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }
                
                // Limpiar campos din√°micos de requisitos
                const reqsContainer = document.getElementById('requirements-container');
                if (reqsContainer) {
                    reqsContainer.innerHTML = `
                        <div class="requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3">
                            <input type="text" name="requirement_ship_1" 
                                   placeholder="Nombre de nave/plano requerido (ej: Starblaze Scout)" 
                                   class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                            <input type="number" name="requirement_amount_1" placeholder="Cantidad" min="1" 
                                   class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                            <button type="button" onclick="removeRequirementField(this)" 
                                    class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }
                
                
                // Limpiar slots de componentes
const slotsContainer = document.getElementById('component-slots-container');
if (slotsContainer) {
    const descriptionText = slotsContainer.querySelector('p');
    slotsContainer.innerHTML = '';
    if (descriptionText) slotsContainer.appendChild(descriptionText);
    
    componentSlotCounter = 1;
    const newSlot = document.createElement('div');
    newSlot.className = 'component-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
    newSlot.innerHTML = `
        <span class="sm:col-span-1 flex items-center justify-center text-gray-400 font-bold">1.</span>
        <select name="slot_component_type_1" 
                class="sm:col-span-10 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 text-sm">
            <option value="">Selecciona tipo de componente...</option>
            <optgroup label="‚öîÔ∏è Armas">
                <option value="ca√±on">üî´ Ca√±√≥n</option>
                <option value="misil">üöÄ Misil</option>
                <option value="perforador">üî© Perforador</option>
                <option value="rayo_termico">üî• Rayo T√©rmico</option>
                <option value="ca√±on_largo_alcance">üéØ Ca√±√≥n de Largo Alcance</option>
                <option value="bomba_agresion">üí£ Bomba de Agresi√≥n</option>
                <option value="carga_ataque">‚ö° Carga de Ataque</option>
                <option value="ataque_orbital">üõ∏ Ataque Orbital</option>
                <option value="bomba_lapa">üß® Bomba Lapa</option>
                <option value="haz_electrico">‚ö° Haz El√©ctrico</option>
            </optgroup>
            <optgroup label="üîß Soporte">
                <option value="recolector">üì¶ Recolector</option>
                <option value="reparador">üîß Reparador</option>
                <option value="telerreparador">üì° Telereparador</option>
                <option value="campo_reparacion">üõ†Ô∏è Campo de Reparaci√≥n</option>
                <option value="protector">üõ°Ô∏è Protector</option>
                <option value="resurrector">‚ù§Ô∏è Resurrector</option>
                <option value="picador">‚õèÔ∏è Picador</option>
                <option value="torre_reparacion">üè• Torre de Reparaci√≥n</option>
            </optgroup>
            <optgroup label="üöÄ Movilidad">
                <option value="impulsor">üöÄ Impulsor</option>
                <option value="acelerador">‚ö° Acelerador</option>
                <option value="desacelerador">üêå Desacelerador</option>
                <option value="salto_cuantico">üåÄ Salto Cu√°ntico</option>
            </optgroup>
            <optgroup label="üõ°Ô∏è Defensa">
                <option value="escudo">üõ°Ô∏è Escudo</option>
                <option value="se√±uelo">üé≠ Se√±uelo</option>
                <option value="paralizador">üí• Paralizador</option>
                <option value="se√±al_interferencia">üì° Se√±al de Interferencia</option>
                <option value="inversor_da√±o">üîÑ Inversor de Da√±o</option>
                <option value="droide_reflector">üîÆ Droide Reflector</option>
                <option value="absorvedor_alcance">üåê Absorbedor de Alcance</option>
            </optgroup>
            <optgroup label="ü§ñ Drones y Especiales">
                <option value="mira">üéØ Mira</option>
                <option value="droide_ataque">ü§ñ Droide de Ataque</option>
                <option value="torre_ataque">üè∞ Torre de Ataque</option>
                <option value="mina">üí£ Mina</option>
                <option value="trampa_magnetica">üß≤ Trampa Magn√©tica</option>
                <option value="nube_corrosiva">‚ò†Ô∏è Nube Corrosiva</option>
                <option value="aura_conducta">‚ú® Aura de Conducta</option>
            </optgroup>
        </select>
        <button type="button" onclick="removeComponentSlot(this)" 
                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    `;
    slotsContainer.appendChild(newSlot);
}
                
                // Limpiar ranuras Cortex
                const cortexContainer = document.getElementById('cortex-slots-container');
                if (cortexContainer) {
                    cortexContainer.innerHTML = `
                        <div class="cortex-slot grid grid-cols-1 sm:grid-cols-12 gap-2">
                            <span class="sm:col-span-1 flex items-center justify-center text-cyan-400 font-bold">1.</span>
                            
                            <div class="sm:col-span-5 relative">
                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="cortex_slot_price_1" placeholder="Compra (ej: 50000)" min="0"
                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
                            </div>
                            
                            <div class="sm:col-span-5 relative">
                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="cortex_slot_sell_1" placeholder="Venta (ej: 25000)" min="0"
                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                            </div>
                            
                            <button type="button" onclick="removeCortexSlot(this)" 
                                    class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }
                
                // Limpiar ranuras Drones
                const droneContainer = document.getElementById('drone-slots-container');
                if (droneContainer) {
                    droneContainer.innerHTML = `
                        <div class="drone-slot grid grid-cols-1 sm:grid-cols-12 gap-2">
                            <span class="sm:col-span-1 flex items-center justify-center text-purple-400 font-bold">1.</span>
                            
                            <div class="sm:col-span-5 relative">
                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="drone_slot_price_1" placeholder="Compra (ej: 75000)" min="0"
                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                            </div>
                            
                            <div class="sm:col-span-5 relative">
                                <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="drone_slot_sell_1" placeholder="Venta (ej: 37500)" min="0"
                                       class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                            </div>
                            
                            <button type="button" onclick="removeDroneSlot(this)" 
                                    class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }
                
                // Limpiar campos espec√≠ficos de componentes
                // Limpiar campos espec√≠ficos de componentes
if (type === 'components') {
    compRequirementCounter = 1;
    clearCompImage2D();
    clearCompModel3D();
    
    // üî• RESETEAR NOMBRE Y CLASE
    const nameInput = document.getElementById('component-name');
    const classSelect = document.getElementById('component-class');
    const levelInput = document.getElementById('component-level');
    const systemInput = document.getElementById('component-system');
    
    if (nameInput) nameInput.value = '';
    if (classSelect) classSelect.value = '';
    if (levelInput) levelInput.value = '';
    if (systemInput) systemInput.value = '';
    
    const compReqsContainer = document.getElementById('comp-requirements-container');
    if (compReqsContainer) {
        compReqsContainer.innerHTML = `
            <div class="comp-requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3">
                <input type="text" name="comp_requirement_item_1" 
                    placeholder="Nombre del plano/componente requerido" 
                    class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                <input type="number" name="comp_requirement_amount_1" placeholder="Cantidad" min="1" 
                    class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                <button type="button" onclick="removeCompRequirementField(this)" 
                        class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
        `;
    }
}

                // Llenar selectores de componentes si es el formulario de naves
if (type === 'ships') {
    setTimeout(() => {
        populateComponentSelects();
    }, 100);
}

                lucide.createIcons();
            }
        }
        
        // ============================================
        // HANDLERS DE FORMULARIOS
        // ============================================
        
        function handleAddShip(event) {
            event.preventDefault();
            const data = new FormData(event.target);

            // üî• DETECTAR SI ESTAMOS EDITANDO
            const editingShipId = data.get('editingShipId');
            const isEditing = !!editingShipId;
            
            // Obtener clases seleccionadas
            const selectedClasses = [];
            document.querySelectorAll('input[name="classes"]:checked').forEach(checkbox => {
                selectedClasses.push(checkbox.value);
            });
            
            // Obtener buffs de la nave
            const shipBuffs = [];
            let buffIndex = 1;
            while (true) {
            const buffType = data.get(`ship_buff_type_${buffIndex}`);
            const buffValue = data.get(`ship_buff_value_${buffIndex}`);
            
            if (!buffType && !buffValue) break; // No hay m√°s buffs
            
            if (buffType && buffValue) {
                shipBuffs.push({
                    type: sanitizeText(buffType),
                    value: safeNumber(buffValue, 0)
                });
            }
            buffIndex++;
            }

            // Obtener blindajes con multiplicador y bono (SIN buffs aqu√≠)
        const armors = [];
        for (let i = 1; i <= armorCounter; i++) {
            const name = data.get(`armor_name_${i}`);
            const level = data.get(`armor_level_${i}`);
            const price = data.get(`armor_price_${i}`);
            const sellPrice = data.get(`armor_sell_${i}`);
            const multiplier = data.get(`armor_multiplier_${i}`);
            const bonus = data.get(`armor_bonus_${i}`);
            
            if (name && name.trim() !== '') {
                armors.push({
                    name: sanitizeText(name),
                    level: safeNumber(level, 1),
                    price: safeNumber(price, 0),
                    sellPrice: safeNumber(sellPrice, 0),
                    multiplier: safeNumber(multiplier, 1),
                    bonus: safeNumber(bonus, 0)
                });
            }
            }   
            
            // Obtener requisitos de descifrado
            const requirements = [];
            for (let i = 1; i <= requirementCounter; i++) {
                const shipName = data.get(`requirement_ship_${i}`);
                const amount = data.get(`requirement_amount_${i}`);
                if (shipName && shipName.trim() !== '') {
                    requirements.push({
                        ship: sanitizeText(shipName),
                        amount: safeNumber(amount, 1)
                    });
                }
            }
            
            // Obtener slots de componentes
            const componentSlots = [];
            document.querySelectorAll('[name^="slot_component_"]').forEach(input => {
                const value = input.value.trim();
                if (value) componentSlots.push(sanitizeText(value));
            });
            
            // Obtener tipos de componentes para slots
const componentSlotTypes = [];
document.querySelectorAll('[name^="slot_component_type_"]').forEach(select => {
    const value = select.value.trim();
    if (value) componentSlotTypes.push(sanitizeText(value));
});

            // Obtener ranuras Cortex con precios escalonados

const cortexSlots = [];
for (let i = 1; i <= cortexSlotCounter; i++) {
    const buyPrice = data.get(`cortex_slot_price_${i}`);
    const sellPrice = data.get(`cortex_slot_sell_${i}`);
    if (buyPrice !== null && buyPrice !== '') {
        cortexSlots.push({
            slot: i,
            buyPrice: safeNumber(buyPrice, 0),
            sellPrice: safeNumber(sellPrice, 0)
        });
    }
}
            
            // Obtener ranuras Drones (incluso si cuestan 0)
const droneSlots = [];
for (let i = 1; i <= droneSlotCounter; i++) {
    const buyPrice = data.get(`drone_slot_price_${i}`);
    const sellPrice = data.get(`drone_slot_sell_${i}`);
    if (buyPrice !== null && buyPrice !== '') {
        droneSlots.push({
            slot: i,
            buyPrice: safeNumber(buyPrice, 0),
            sellPrice: safeNumber(sellPrice, 0)
        });
    }
}

            // üî• OBTENER IMAGEN 2D (Base64 o URL)
            let image2D = document.getElementById('image2d-data').value; // Base64
            if (!image2D) {
                image2D = data.get('image2D_url') || ''; // URL alternativa
            }

            // üî• OBTENER MODELO 3D (Base64 o URL)
            let model3D = document.getElementById('model3d-data').value; // Base64
            if (!model3D) {
                model3D = data.get('model3D_url') || ''; // URL alternativa
            }
            
            const ship = {
                id: generateUniqueId('ship-'),
                name: sanitizeText(data.get('name')),
                classes: selectedClasses,
                shipBuffs: shipBuffs,
                level: safeNumber(data.get('level'), 1),
                system: sanitizeText(data.get('system')),
                
                // Estad√≠sticas
                armorIndex: safeNumber(data.get('armorIndex'), 0),
                speed: safeNumber(data.get('speed'), 0),
                performance: safeNumber(data.get('performance'), 0),
                
                // Blindajes con precio de venta
                armors: armors,
                
                // Componentes
                componentSlots: safeNumber(data.get('componentSlots'), 0),
                slotComponents: componentSlotTypes,
                
                // Econom√≠a b√°sica
                crionita: safeNumber(data.get('crionita'), 0),
                oro: safeNumber(data.get('oro'), 0),
                sellPrice: safeNumber(data.get('sellPrice'), 0),
                
                // Ranuras Cortex y Drones con precios escalonados
                cortexSlots: cortexSlots,
                droneSlots: droneSlots,
                
                // Costos miscel√°neos
                paintCost: safeNumber(data.get('paintCost'), 0),
                renameCost: safeNumber(data.get('renameCost'), 0),
                configCost: safeNumber(data.get('configCost'), 0),     
                repairCost: safeNumber(data.get('repairCost'), 0),
                
                // Obtenci√≥n
                obtainMethod: sanitizeText(data.get('obtainMethod')),
                obtainLocation: sanitizeText(data.get('obtainLocation')),
                blueprintsRequired: safeNumber(data.get('blueprintsRequired'), 0),
                requirements: requirements,
                
                // Visuales (Base64 o URL)
                image2D: image2D,
                model3D: model3D,
                description: sanitizeText(data.get('description')),
                lore: sanitizeText(data.get('lore'))
            };
            
            // Validaciones
            if (!ship.name || ship.name.length < 3) {
                notify('El nombre debe tener al menos 3 caracteres', 'warning');
                return;
            }
            
            if (selectedClasses.length === 0) {
                notify('Debes seleccionar al menos una clase', 'warning');
                return;
            }
            
            if (!ship.obtainMethod) {
                notify('Debes especificar d√≥nde se obtiene la nave', 'warning');
                return;
            }
            
            const ships = DB.ships();
            // üî• DETECTAR MODO EDICI√ìN
if (isEditing) {
    // ACTUALIZAR nave existente
    const index = ships.findIndex(s => s.id === editingShipId);
    if (index !== -1) {
        // Mantener el ID original y actualizar el resto
        ships[index] = { ...ship, id: editingShipId };
        notify(`Nave "${ship.name}" actualizada exitosamente`, 'success');
    } else {
        notify('Error: Nave no encontrada para editar', 'error');
        return;
    }
    
    // Limpiar input oculto de edici√≥n
    const hiddenInput = event.target.querySelector('[name="editingShipId"]');
    if (hiddenInput) hiddenInput.remove();
    
    // Restaurar t√≠tulo del formulario
    const formTitle = document.querySelector('#ships-form h3');
    formTitle.innerHTML = `
        <i data-lucide="plus-circle" class="w-5 h-5"></i>Agregar Nueva Nave
    `;
} else {
    // CREAR nave nueva
    ships.push(ship);
    notify(`Nave "${ship.name}" agregada exitosamente`, 'success');
}

DB.save('ships', ships);
            
            event.target.reset();
            armorCounter = 1;
            requirementCounter = 1;
            componentSlotCounter = 1;
            cortexSlotCounter = 1;
            droneSlotCounter = 1;
            clearImage2D();
            clearModel3D();
            toggleForm('ships');
            notify(`Nave "${ship.name}" agregada exitosamente`, 'success');
            loadShips();
            }
        
        // Contador para requisitos de componentes
let compRequirementCounter = 1;

// ============================================
// GESTI√ìN DE REQUISITOS DE COMPONENTES
// ============================================

function addCompRequirementField() {
    compRequirementCounter++;
    const container = document.getElementById('comp-requirements-container');
    const newRow = document.createElement('div');
    newRow.className = 'comp-requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3';
    newRow.innerHTML = `
        <input type="text" name="comp_requirement_item_${compRequirementCounter}" 
               placeholder="Nombre del plano/componente requerido" 
               class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
        <input type="number" name="comp_requirement_amount_${compRequirementCounter}" placeholder="Cantidad" min="1" 
               class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
        <button type="button" onclick="removeCompRequirementField(this)" 
                class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    `;
    container.appendChild(newRow);
    lucide.createIcons();
}

function removeCompRequirementField(button) {
    button.closest('.comp-requirement-row').remove();
}

// ============================================
// MANEJO DE IMAGEN DE COMPONENTE
// ============================================

function handleCompImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        notify('El archivo debe ser una imagen', 'error');
        return;
    }
    
    if (file.size > 2 * 1024 * 1024) {
        notify('La imagen no debe superar 2MB', 'warning');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        const base64 = e.target.result;
        document.getElementById('comp-image-data').value = base64;
        document.getElementById('comp-image-preview-img').src = base64;
        document.getElementById('comp-image-filename').textContent = file.name;
        document.getElementById('comp-image-preview').classList.remove('hidden');
        notify('Imagen de componente cargada', 'success');
    };
    reader.readAsDataURL(file);
}

function clearCompImage() {
    document.getElementById('comp-image-file').value = '';
    document.getElementById('comp-image-data').value = '';
    document.getElementById('comp-image-preview').classList.add('hidden');
    notify('Imagen eliminada', 'info');
}

// ============================================
// MANEJO DE IM√ÅGENES 2D DE COMPONENTES
// ============================================

function handleCompImage2DUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        notify('El archivo debe ser una imagen', 'error');
        return;
    }
    
    if (file.size > 2 * 1024 * 1024) {
        notify('La imagen no debe superar 2MB', 'warning');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        const base64 = e.target.result;
        document.getElementById('comp-image2d-data').value = base64;
        document.getElementById('comp-image2d-preview-img').src = base64;
        document.getElementById('comp-image2d-filename').textContent = file.name;
        document.getElementById('comp-image2d-preview').classList.remove('hidden');
        notify('Imagen de componente cargada', 'success');
    };
    reader.readAsDataURL(file);
}

function clearCompImage2D() {
    const fileInput = document.getElementById('comp-image2d-file');
    const dataInput = document.getElementById('comp-image2d-data');
    const preview = document.getElementById('comp-image2d-preview');
    
    if (fileInput) fileInput.value = '';
    if (dataInput) dataInput.value = '';
    if (preview) preview.classList.add('hidden');
    notify('Imagen eliminada', 'info');
}

// ============================================
// MANEJO DE MODELOS 3D DE COMPONENTES
// ============================================

function handleCompModel3DUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const validExtensions = ['.glb', '.gltf'];
    const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
    
    if (!validExtensions.includes(fileExtension)) {
        notify('El archivo debe ser GLB o GLTF', 'error');
        return;
    }
    
    if (file.size > 20 * 1024 * 1024) {
        notify('El modelo no debe superar 20MB', 'warning');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        const base64 = e.target.result;
        document.getElementById('comp-model3d-data').value = base64;
        document.getElementById('comp-model3d-filename').textContent = file.name;
        document.getElementById('comp-model3d-size').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
        document.getElementById('comp-model3d-info').classList.remove('hidden');
        notify('Modelo 3D de componente cargado', 'success');
    };
    reader.readAsDataURL(file);
}

function clearCompModel3D() {
    const fileInput = document.getElementById('comp-model3d-file');
    const dataInput = document.getElementById('comp-model3d-data');
    const info = document.getElementById('comp-model3d-info');
    
    if (fileInput) fileInput.value = '';
    if (dataInput) dataInput.value = '';
    if (info) info.classList.add('hidden');
    notify('Modelo 3D eliminado', 'info');
}

// ============================================
// HANDLER DE COMPONENTES ACTUALIZADO
// ============================================

function handleAddComponent(event) {
    event.preventDefault();
    const data = new FormData(event.target);
    
    // Obtener requisitos de descifrado
    const requirements = [];
    for (let i = 1; i <= compRequirementCounter; i++) {
        const itemName = data.get(`comp_requirement_item_${i}`);
        const amount = data.get(`comp_requirement_amount_${i}`);
        if (itemName && itemName.trim() !== '') {
            requirements.push({
                item: sanitizeText(itemName),
                amount: safeNumber(amount, 1)
            });
        }
    }

    // Obtener imagen (Base64 o URL)
    // üî• OBTENER IMAGEN 2D (Base64 o URL)
let componentImage = document.getElementById('comp-image2d-data').value; // Base64
if (!componentImage) {
    componentImage = data.get('comp_image2D_url') || ''; // URL alternativa
}

// üî• OBTENER MODELO 3D (Base64 o URL)
let componentModel = document.getElementById('comp-model3d-data').value; // Base64
if (!componentModel) {
    componentModel = data.get('comp_model3D_url') || ''; // URL alternativa
}
    
    const component = {
        id: generateUniqueId('component-'),
        name: sanitizeText(data.get('component_name')), // üî• CORREGIDO
        componentClass: sanitizeText(data.get('component_class')), // üî• NUEVA L√çNEA
        level: safeNumber(data.get('comp_level'), 1),
        system: sanitizeText(data.get('comp_system')),
        
        // Categor√≠a y tipo
        category: sanitizeText(data.get('comp_category')),
        type: sanitizeText(data.get('comp_type')),
        rarity: sanitizeText(data.get('comp_rarity')),
        power: safeNumber(data.get('comp_power'), 0),
        
        // Tipo de plano
        blueprintType: sanitizeText(data.get('comp_blueprint_type')),
        
        // Econom√≠a
        priceCrionita: safeNumber(data.get('comp_price_crionita'), 0),
        priceGold: safeNumber(data.get('comp_price_gold'), 0),
        sellPrice: safeNumber(data.get('comp_sell_price'), 0),
        
        // Planos
        blueprintsForItem: safeNumber(data.get('comp_blueprints_item'), 0),
        blueprintsToDecrypt: safeNumber(data.get('comp_blueprints_decrypt'), 0),
        
        // Obtenci√≥n
        obtainMethod: sanitizeText(data.get('comp_obtain_method')),
        obtainLocation: sanitizeText(data.get('comp_obtain_location')),
        requirements: requirements,
        
        // Visuales
        image: componentImage,
        model3D: componentModel,   
        description: sanitizeText(data.get('comp_description')),
        lore: sanitizeText(data.get('comp_lore'))
    };
    
    // Validaciones
    if (!component.name || component.name.length < 3) {
        notify('El nombre debe tener al menos 3 caracteres', 'warning');
        return;
    }

    if (!component.componentClass) {
    notify('Debes seleccionar una clase de componente', 'warning');
    return;
    }
    
    if (!component.category) {
        notify('Debes seleccionar una categor√≠a', 'warning');
        return;
    }
    
    if (!component.type) {
        notify('Debes seleccionar un tipo de componente', 'warning');
        return;
    }
    
    if (!component.obtainMethod) {
        notify('Debes especificar d√≥nde se obtiene', 'warning');
        return;
    }
    
    const components = DB.components();
    components.push(component);
    DB.save('components', components);
    
    event.target.reset();
    compRequirementCounter = 1;
    clearCompImage();
    toggleForm('components');
    notify(`Componente "${component.name}" agregado exitosamente`, 'success');
    loadComponents();
}

        function handleAddPlanet(event) {
            event.preventDefault();
            const data = new FormData(event.target);
            const planet = {
                id: generateUniqueId('planet-'),
                name: sanitizeText(data.get('name')), 
                system: sanitizeText(data.get('system')), 
                type: sanitizeText(data.get('type')),
                minLevel: safeNumber(data.get('minLevel'), 1), 
                model3D: sanitizeText(data.get('model3D')), 
                map2D: sanitizeText(data.get('map2D')),
                faction: sanitizeText(data.get('faction')), 
                resources: sanitizeText(data.get('resources')), 
                lore: sanitizeText(data.get('lore'))
            };
            const planets = DB.planets();
            planets.push(planet);
            DB.save('planets', planets);
            event.target.reset();
            toggleForm('planets');
            notify(`Planeta "${planet.name}" agregado`, 'success');
            loadPlanets();
        }

        function handleAddSystem(event) {
            event.preventDefault();
            const data = new FormData(event.target);
            const id = sanitizeText(data.get('id'));
            if (!/^[a-z0-9-]+$/.test(id)) { 
                notify('ID del sistema inv√°lido', 'warning'); 
                return; 
            }
            if (DB.systems().some(sys => sys.id === id)) { 
                notify('ID ya existe', 'error'); 
                return; 
            }

            const system = {
                id,
                name: sanitizeText(data.get('name')), 
                type: sanitizeText(data.get('type')), 
                minLevel: safeNumber(data.get('minLevel'), 1),
                planetCount: safeNumber(data.get('planetCount'), 0), 
                faction: sanitizeText(data.get('faction')), 
                mapImage: sanitizeText(data.get('mapImage')),
                description: sanitizeText(data.get('description'))
            };
            const systems = DB.systems();
            systems.push(system);
            DB.save('systems', systems);
            event.target.reset();
            toggleForm('systems');
            notify(`Sistema "${system.name}" agregado`, 'success');
            loadSystems();
        }
        
        // ============================================
        // CARGA DE DATOS CON ICONOS
        // ============================================
        
        function loadShips() {
            console.log('[Admin Panel] loadShips iniciado');
            const container = document.getElementById('ships-list');
            const ships = DB.ships();
            console.log(`[Admin Panel] Naves encontradas: ${ships.length}`);
            
            if (!ships.length) {
                container.innerHTML = '<div class="content-panel p-8 text-center"><p class="text-gray-400">No hay naves registradas. ¬°Agrega la primera!</p></div>';
                lucide.createIcons();
                return;
            }
            
            container.innerHTML = ships.map(ship => {
                const classesStr = Array.isArray(ship.classes) 
                    ? ship.classes.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ')
                    : (ship.class || 'N/A');
                
                // Mostrar buffs de la nave
const shipBuffsHTML = ship.shipBuffs && ship.shipBuffs.length > 0
    ? `<div class="mt-2 text-xs flex flex-wrap gap-2">
        <span class="text-purple-400 font-semibold">‚ú® Buffs:</span>
        ${ship.shipBuffs.map(b => `
            <span class="inline-flex items-center gap-1 bg-purple-500/10 px-2 py-1 rounded border border-purple-500/30">
                ${b.type}: <span class="text-green-400">+${b.value}%</span>
            </span>
        `).join('')}
       </div>`
    : '';

                const obtainMethodLabels = {
                    tienda: 'üõí Tienda',
                    mision: 'üìú Misi√≥n',
                    drop: 'üíÄ Drop',
                    evento: 'üéâ Evento',
                    planos: 'üìã Planos',
                    premium: '‚≠ê Premium'
                };
                
                // Mostrar blindajes con multiplicador y bono (SIN buffs)
// Mostrar blindajes (incluso si cuestan 0)
const armorsHTML = ship.armors && ship.armors.length > 0 
    ? `<div class="mt-2 text-xs flex flex-wrap gap-2">
        <span class="text-cyan-400 font-semibold">üõ°Ô∏è Blindajes:</span>
        ${ship.armors.map(a => `
            <span class="inline-flex items-center gap-1 bg-cyan-500/10 px-2 py-1 rounded border border-cyan-500/30">
                ${a.name} (Lv${a.level}) 
                <span class="text-yellow-400">√ó${a.multiplier || 1}</span>
                ${a.bonus ? `<span class="text-green-400">+${a.bonus}</span>` : ''}
                <span class="inline-flex items-center gap-0.5">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
                    ${a.price === 0 ? 'Gratis' : formatNumber(a.price)}
                </span>
                <span class="text-green-400 inline-flex items-center gap-0.5">
                    ‚Üí <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3 opacity-70" onerror="this.style.display='none'">
                    ${a.sellPrice === 0 ? 'N/A' : formatNumber(a.sellPrice)}
                </span>
            </span>
        `).join('')}
       </div>`
    : '';

    // Mostrar tipos de componentes en slots
const componentSlotsHTML = ship.slotComponents && ship.slotComponents.length > 0
    ? `<div class="mt-2 text-xs flex flex-wrap gap-2">
        <span class="text-yellow-400 font-semibold">üîß Slots:</span>
        ${ship.slotComponents.map((type, index) => `
            <span class="inline-flex items-center gap-1 bg-yellow-500/10 px-2 py-1 rounded border border-yellow-500/30">
                ${index + 1}. ${type || 'Vac√≠o'}
            </span>
        `).join('')}
       </div>`
    : '';
                
                // Mostrar ranuras Cortex con iconos
                const cortexHTML = ship.cortexSlots && ship.cortexSlots.length > 0
                    ? `<div class="mt-2 text-xs flex flex-wrap gap-2">
                        <span class="text-cyan-400 font-semibold">üß† Cortex:</span>
                        ${ship.cortexSlots.map(c => `
                            <span class="inline-flex items-center gap-1 bg-cyan-500/10 px-2 py-1 rounded border border-cyan-500/30">
                                Slot ${c.slot}:
                                <span class="inline-flex items-center gap-0.5">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
                                    ${formatNumber(c.buyPrice)}
                                </span>
                                <span class="text-green-400 inline-flex items-center gap-0.5">
                                    ‚Üí <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3 opacity-70" onerror="this.style.display='none'">
                                    ${formatNumber(c.sellPrice)}
                                </span>
                            </span>
                        `).join('')}
                       </div>`
                    : '';
                
                // Mostrar ranuras Drones con iconos
                // Mostrar ranuras Drones (incluso si cuestan 0)
const droneHTML = ship.droneSlots && ship.droneSlots.length > 0
    ? `<div class="mt-2 text-xs flex flex-wrap gap-2">
        <span class="text-purple-400 font-semibold">ü§ñ Drones:</span>
        ${ship.droneSlots.map(d => `
            <span class="inline-flex items-center gap-1 bg-purple-500/10 px-2 py-1 rounded border border-purple-500/30">
                Slot ${d.slot}:
                <span class="inline-flex items-center gap-0.5">
                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
                    ${d.buyPrice === 0 ? 'Gratis' : formatNumber(d.buyPrice)}
                </span>
                <span class="text-green-400 inline-flex items-center gap-0.5">
                    ‚Üí <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3 opacity-70" onerror="this.style.display='none'">
                    ${d.sellPrice === 0 ? 'N/A' : formatNumber(d.sellPrice)}
                </span>
            </span>
        `).join('')}
       </div>`
    : '';

                // Mostrar costos miscel√°neos con iconos (actualizado)
const extraCostsHTML = (ship.paintCost !== undefined || ship.renameCost !== undefined || ship.configCost !== undefined || ship.repairCost !== undefined)
    ? `<div class="mt-2 text-xs flex gap-3 flex-wrap">
        ${ship.paintCost ? `<span class="inline-flex items-center gap-1">
            üé® Pintura: 
            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
            ${formatNumber(ship.paintCost)}
        </span>` : ''}
        ${ship.renameCost ? `<span class="inline-flex items-center gap-1">
            üìù Renombrar: 
            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
            ${formatNumber(ship.renameCost)}
        </span>` : ''}
        ${ship.configCost ? `<span class="inline-flex items-center gap-1">
            ‚öôÔ∏è Config: 
            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-3 h-3" onerror="this.style.display='none'">
            ${formatNumber(ship.configCost)}
        </span>` : ''}
        ${ship.repairCost ? `<span class="inline-flex items-center gap-1">
            üîß Reparaci√≥n: 
            <img src="/assets/currencies/Energy.png" alt="Energ√≠a" class="w-3 h-3" onerror="this.style.display='none'">
            ${formatNumber(ship.repairCost)}
        </span>` : ''}
       </div>`
    : '';
                
                return `
                    <div class="content-panel p-5 hover:border-blue-400 transition">
                        <div class="flex justify-between items-start gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-blue-300 text-lg">${sanitizeText(ship.name)}</h3>
                                    <span class="px-2 py-1 rounded text-xs bg-blue-500/20 text-blue-400 border border-blue-500/50">
                                        Nivel ${ship.level}
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-400 mb-2">
                                    <span class="font-semibold text-purple-400">Clases:</span> ${classesStr}
                                </div>
                                
                                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm mt-3">
                                    <div><span class="text-gray-500">Armor:</span> <span class="text-white ml-1">${formatNumber(ship.armorIndex || 0)}</span></div>
                                    <div><span class="text-gray-500">Speed:</span> <span class="text-white ml-1">${ship.speed || 0}</span></div>
                                    <div><span class="text-gray-500">Perf:</span> <span class="text-white ml-1">${ship.performance || 'N/A'}</span></div>
                                    ${ship.componentSlots ? `<div><span class="text-gray-500">Slots:</span> <span class="text-yellow-400 ml-1">${ship.componentSlots}</span></div>` : ''}
                                </div>
                                
                                ${armorsHTML}
                                ${cortexHTML}
                                ${droneHTML}
                                
                                ${(ship.crionita !== undefined || ship.oro !== undefined || ship.sellPrice !== undefined) ? `
                                    <div class="flex gap-4 mt-3 text-sm">
                                        ${ship.crionita ? `<div class="inline-flex items-center gap-1">
                                            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                            <span class="text-yellow-400">${formatNumber(ship.crionita)}</span>
                                        </div>` : ''}
                                        ${ship.oro ? `<div class="inline-flex items-center gap-1">
                                            <img src="/assets/currencies/gold.png" alt="Oro" class="w-4 h-4" onerror="this.style.display='none'">
                                            <span class="text-orange-400">${formatNumber(ship.oro)}</span>
                                        </div>` : ''}
                                        ${ship.sellPrice ? `<div class="inline-flex items-center gap-1 text-green-400">
                                            üí∞ <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                            <span>${formatNumber(ship.sellPrice)}</span>
                                        </div>` : ''}
                                    </div>
                                ` : ''}
                                
                                ${extraCostsHTML}
                                
                                ${ship.obtainMethod ? `
                                    <p class="text-xs text-gray-400 mt-2">${obtainMethodLabels[ship.obtainMethod] || ship.obtainMethod} ${ship.obtainLocation ? `‚Ä¢ ${sanitizeText(ship.obtainLocation)}` : ''}</p>
                                ` : ''}
                                
                                ${ship.blueprintsRequired ? `
                                    <p class="text-xs text-blue-400 mt-1">üìã Requiere ${ship.blueprintsRequired} planos</p>
                                ` : ''}
                                
                                ${ship.requirements && ship.requirements.length > 0 ? `
                                    <p class="text-xs text-red-400 mt-1">üîí Requisitos: ${ship.requirements.map(r => `${r.amount}x ${r.ship}`).join(', ')}</p>
                                ` : ''}
                                ${componentSlotsHTML}
${shipBuffsHTML}

${ship.description ? `
    <div class="mt-3 p-3 bg-gray-800/50 rounded-lg border border-gray-700">
        <p class="text-xs font-semibold text-blue-400 mb-1">üìù Descripci√≥n</p>
        <p class="text-xs text-gray-300">${sanitizeText(ship.description)}</p>
    </div>
` : ''}

${ship.lore ? `
    <div class="mt-2 p-3 bg-gray-800/50 rounded-lg border border-gray-700">
        <p class="text-xs font-semibold text-purple-400 mb-1">üìñ Historia / Lore</p>
        <p class="text-xs text-gray-300 line-clamp-3">${sanitizeText(ship.lore)}</p>
    </div>
` : ''}

            ${ship.image2D || ship.model3D ? `
                <div class="mt-2 flex gap-2 text-xs">
                    ${ship.image2D ? '<span class="inline-flex items-center gap-1 text-indigo-400"><i data-lucide="image" class="w-3 h-3"></i>Imagen 2D</span>' : ''}
                    ${ship.model3D ? '<span class="inline-flex items-center gap-1 text-indigo-400"><i data-lucide="box" class="w-3 h-3"></i>Modelo 3D</span>' : ''}
                </div>
            ` : ''}

                            </div>
                            
                            <div class="flex gap-2 flex-shrink-0">
                                <button onclick="editShip('${ship.id}')" 
                                        class="game-nav-item px-3 py-2 text-sm hover:bg-blue-500/20" title="Editar">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteItem('ships', '${ship.id}')" 
                                        class="game-nav-item px-3 py-2 text-sm hover:bg-red-500/20" title="Eliminar">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
            console.log('[Admin Panel] loadShips completado');
        }
        
        function editShip(shipId) {
            const ships = DB.ships();
            const ship = ships.find(s => s.id === shipId);
    
            if (!ship) {
                notify('Nave no encontrada', 'error');
                return;
            }
    
            // 1. Mostrar formulario
            const form = document.getElementById('ships-form');
            form.classList.remove('hidden');
            form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 2. Cambiar t√≠tulo
            const formTitle = form.querySelector('h3');
            formTitle.innerHTML = `
                <i data-lucide="edit" class="w-5 h-5 inline"></i>
                Editando: ${sanitizeText(ship.name)}
            `;
            
            // 3. Agregar input oculto con ID de la nave
            let hiddenInput = form.querySelector('[name="editingShipId"]');
            if (!hiddenInput) {
                hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'editingShipId';
                form.querySelector('form').appendChild(hiddenInput);
            }
            hiddenInput.value = shipId;
            
            // 4. Llenar campos b√°sicos
            form.querySelector('[name="name"]').value = ship.name || '';
            form.querySelector('[name="level"]').value = ship.level || 1;
            form.querySelector('[name="system"]').value = ship.system || '';
            form.querySelector('[name="armorIndex"]').value = ship.armorIndex || 0;
            form.querySelector('[name="speed"]').value = ship.speed || 0;
            form.querySelector('[name="performance"]').value = ship.performance || '';
            form.querySelector('[name="componentSlots"]').value = ship.componentSlots || 0;
            form.querySelector('[name="crionita"]').value = ship.crionita || 0;
            form.querySelector('[name="oro"]').value = ship.oro || 0;
            form.querySelector('[name="sellPrice"]').value = ship.sellPrice || 0;
            form.querySelector('[name="paintCost"]').value = ship.paintCost || 0;
            form.querySelector('[name="renameCost"]').value = ship.renameCost || 0;
            form.querySelector('[name="configCost"]').value = ship.configCost || 0;
            form.querySelector('[name="repairCost"]').value = ship.repairCost || 0;
            form.querySelector('[name="obtainMethod"]').value = ship.obtainMethod || '';
            form.querySelector('[name="obtainLocation"]').value = ship.obtainLocation || '';
            form.querySelector('[name="blueprintsRequired"]').value = ship.blueprintsRequired || 0;
            form.querySelector('[name="description"]').value = ship.description || '';
            form.querySelector('[name="lore"]').value = ship.lore || '';
            form.querySelector('[name="image2D_url"]').value = (ship.image2D && !ship.image2D.startsWith('data:')) ? ship.image2D : '';
            form.querySelector('[name="model3D_url"]').value = (ship.model3D && !ship.model3D.startsWith('data:')) ? ship.model3D : '';
            
            // 5. Marcar clases seleccionadas
            form.querySelectorAll('[name="classes"]').forEach(checkbox => {
                checkbox.checked = ship.classes && ship.classes.includes(checkbox.value);
            });
            
            // 6. Recrear buffs de la nave
            const shipBuffsContainer = document.getElementById('ship-buffs-container');
            shipBuffsContainer.innerHTML = '';
            if (ship.shipBuffs && ship.shipBuffs.length > 0) {
                ship.shipBuffs.forEach((buff, index) => {
                    const buffIndex = index + 1;
                    const buffRow = document.createElement('div');
                    buffRow.className = 'ship-buff-row grid grid-cols-1 sm:grid-cols-12 gap-2 mb-2';
                    buffRow.innerHTML = `
                        <select name="ship_buff_type_${buffIndex}" 
                                class="sm:col-span-5 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                            <option value="">Selecciona tipo de buff...</option>
                            <option value="velocidad" ${buff.type === 'velocidad' ? 'selected' : ''}>üöÄ Velocidad</option>
                            <option value="defensa" ${buff.type === 'defensa' ? 'selected' : ''}>üõ°Ô∏è Defensa</option>
                            <option value="ataque" ${buff.type === 'ataque' ? 'selected' : ''}>‚öîÔ∏è Ataque</option>
                            <option value="hp" ${buff.type === 'hp' ? 'selected' : ''}>‚ù§Ô∏è HP</option>
                            <option value="escudo" ${buff.type === 'escudo' ? 'selected' : ''}>üî∞ Escudo</option>
                            <option value="energia" ${buff.type === 'energia' ? 'selected' : ''}>‚ö° Energ√≠a</option>
                            <option value="regeneracion" ${buff.type === 'regeneracion' ? 'selected' : ''}>üíö Regeneraci√≥n</option>
                            <option value="evasion" ${buff.type === 'evasion' ? 'selected' : ''}>üí® Evasi√≥n</option>
                            <option value="precision" ${buff.type === 'precision' ? 'selected' : ''}>üéØ Precisi√≥n</option>
                            <option value="alcance" ${buff.type === 'alcance' ? 'selected' : ''}>üìè Alcance</option>
                            <option value="critico" ${buff.type === 'critico' ? 'selected' : ''}>üí• Cr√≠tico</option>
                            <option value="resistencia" ${buff.type === 'resistencia' ? 'selected' : ''}>üí™ Resistencia</option>
                            <option value="velocidad_disparo" ${buff.type === 'velocidad_disparo' ? 'selected' : ''}>‚ö° Velocidad de Disparo</option>
                            <option value="reduccion_cooldown" ${buff.type === 'reduccion_cooldown' ? 'selected' : ''}>‚è±Ô∏è Reducci√≥n de Cooldown</option>
                            <option value="robo_vida" ${buff.type === 'robo_vida' ? 'selected' : ''}>ü©∏ Robo de Vida</option>
                            <option value="velocidad_recarga" ${buff.type === 'velocidad_recarga' ? 'selected' : ''}>üîã Velocidad de Recarga</option>
                        </select>
                        
                        <div class="sm:col-span-6 flex items-center gap-2">
                            <input type="number" name="ship_buff_value_${buffIndex}" 
                                value="${buff.value || 0}"
                                placeholder="Valor (%)" min="-100" max="500" step="0.1"
                                class="flex-1 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                            <span class="text-gray-400 text-sm">%</span>
                        </div>
                        
                        <button type="button" onclick="this.closest('.ship-buff-row').remove()" 
                                class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    `;
                    shipBuffsContainer.appendChild(buffRow);
                });
            }
            
            // 7. Recrear blindajes
            const armorsContainer = document.getElementById('armors-container');
            armorsContainer.innerHTML = '';
            armorCounter = 0;
            if (ship.armors && ship.armors.length > 0) {
                ship.armors.forEach((armor, index) => {
                    armorCounter = index + 1;
                    const armorRow = document.createElement('div');
                    armorRow.className = 'armor-row p-4 bg-gray-800/50 rounded-lg border border-gray-700 mb-3';
                    armorRow.innerHTML = `
                        <div class="grid grid-cols-1 sm:grid-cols-12 gap-3 mb-3">
                            <input type="text" name="armor_name_${armorCounter}" value="${sanitizeText(armor.name || '')}" placeholder="Nombre" 
                                class="sm:col-span-4 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            <input type="number" name="armor_level_${armorCounter}" value="${armor.level || 1}" placeholder="Nivel" min="1" 
                                class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            <div class="sm:col-span-2">
                                <input type="number" name="armor_multiplier_${armorCounter}" value="${armor.multiplier || 1}" placeholder="Mult." min="0.1" max="10" step="0.1"
                                    class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                                <span class="text-xs text-gray-500">Ej: 1.5</span>
                            </div>
                            <div class="sm:col-span-3">
                                <input type="number" name="armor_bonus_${armorCounter}" value="${armor.bonus || 0}" placeholder="Bono" min="0"
                                    class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                                <span class="text-xs text-gray-500">Puntos +</span>
                            </div>
                            <button type="button" onclick="removeArmorField(this)" 
                                    class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="relative">
                                <label class="block text-xs text-gray-400 mb-1">üí∞ Compra</label>
                                <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="armor_price_${armorCounter}" value="${armor.price || 0}" placeholder="0" min="0" 
                                    class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                            </div>
                            <div class="relative">
                                <label class="block text-xs text-gray-400 mb-1">üíµ Venta</label>
                                <div class="absolute left-3 top-8 flex items-center pointer-events-none">
                                    <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                </div>
                                <input type="number" name="armor_sell_${armorCounter}" value="${armor.sellPrice || 0}" placeholder="0" min="0" 
                                    class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500">
                            </div>
                        </div>
                    `;
                    armorsContainer.appendChild(armorRow);
                });
            } else {
                armorCounter = 1;
                armorsContainer.innerHTML = `<div class="armor-row p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <div class="grid grid-cols-1 sm:grid-cols-12 gap-3 mb-3">
                        <input type="text" name="armor_name_1" placeholder="Nombre del blindaje" class="sm:col-span-4 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                        <input type="number" name="armor_level_1" placeholder="Nivel" min="1" class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500">
                        <div class="sm:col-span-2"><input type="number" name="armor_multiplier_1" placeholder="Mult." min="0.1" max="10" step="0.1" value="1.0" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500"><span class="text-xs text-gray-500">Ej: 1.5</span></div>
                        <div class="sm:col-span-3"><input type="number" name="armor_bonus_1" placeholder="Bono" min="0" value="0" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500"><span class="text-xs text-gray-500">Puntos +</span></div>
                        <button type="button" onclick="removeArmorField(this)" class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="relative"><label class="block text-xs text-gray-400 mb-1">üí∞ Compra</label><div class="absolute left-3 top-8 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'"></div><input type="number" name="armor_price_1" placeholder="0" min="0" class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500"></div>
                        <div class="relative"><label class="block text-xs text-gray-400 mb-1">üíµ Venta</label><div class="absolute left-3 top-8 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'"></div><input type="number" name="armor_sell_1" placeholder="0" min="0" class="w-full pl-9 pr-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500"></div>
                    </div>
                </div>`;
            }
            
            // 8. Recrear slots de componentes
            const slotsContainer = document.getElementById('component-slots-container');
            const firstChild = slotsContainer.querySelector('p');
            slotsContainer.innerHTML = '';
            if (firstChild) slotsContainer.appendChild(firstChild);
            componentSlotCounter = 0;
            if (ship.slotComponents && ship.slotComponents.length > 0) {
                ship.slotComponents.forEach((type, index) => {
                    componentSlotCounter = index + 1;
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'component-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
                    slotDiv.innerHTML = `
                        <span class="sm:col-span-1 flex items-center justify-center text-gray-400 font-bold">${componentSlotCounter}.</span>
                        <select name="slot_component_type_${componentSlotCounter}" class="sm:col-span-10 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-yellow-500 text-sm">
                            <option value="">Selecciona tipo...</option>
                            <optgroup label="‚öîÔ∏è Armas">
                                <option value="ca√±on" ${type === 'ca√±on' ? 'selected' : ''}>üî´ Ca√±√≥n</option>
                                <option value="misil" ${type === 'misil' ? 'selected' : ''}>üöÄ Misil</option>
                                <option value="perforador" ${type === 'perforador' ? 'selected' : ''}>üî© Perforador</option>
                            </optgroup>
                            <optgroup label="üîß Soporte">
                                <option value="reparador" ${type === 'reparador' ? 'selected' : ''}>üîß Reparador</option>
                                <option value="escudo" ${type === 'escudo' ? 'selected' : ''}>üõ°Ô∏è Escudo</option>
                            </optgroup>
                        </select>
                        <button type="button" onclick="removeComponentSlot(this)" class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center"><i data-lucide="x" class="w-4 h-4"></i></button>
                    `;
                    slotsContainer.appendChild(slotDiv);
                });
            }
            
            // 9. Recrear Cortex slots
            const cortexContainer = document.getElementById('cortex-slots-container');
            cortexContainer.innerHTML = '';
            cortexSlotCounter = 0;
            if (ship.cortexSlots && ship.cortexSlots.length > 0) {
                ship.cortexSlots.forEach((slot, index) => {
                    cortexSlotCounter = index + 1;
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'cortex-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
                    slotDiv.innerHTML = `
                        <span class="sm:col-span-1 flex items-center justify-center text-cyan-400 font-bold">${cortexSlotCounter}.</span>
                        <div class="sm:col-span-5 relative">
                            <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'"></div>
                            <input type="number" name="cortex_slot_price_${cortexSlotCounter}" value="${slot.buyPrice || 0}" placeholder="Compra" min="0" class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-cyan-500 text-sm">
                        </div>
                        <div class="sm:col-span-5 relative">
                            <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'"></div>
                            <input type="number" name="cortex_slot_sell_${cortexSlotCounter}" value="${slot.sellPrice || 0}" placeholder="Venta" min="0" class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                        </div>
                        <button type="button" onclick="removeCortexSlot(this)" class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center"><i data-lucide="x" class="w-4 h-4"></i></button>
                    `;
                    cortexContainer.appendChild(slotDiv);
                });
            }
            
            // 10. Recrear Drone slots
            const droneContainer = document.getElementById('drone-slots-container');
            droneContainer.innerHTML = '';
            droneSlotCounter = 0;
            if (ship.droneSlots && ship.droneSlots.length > 0) {
                ship.droneSlots.forEach((slot, index) => {
                    droneSlotCounter = index + 1;
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'drone-slot grid grid-cols-1 sm:grid-cols-12 gap-2';
                    slotDiv.innerHTML = `
                        <span class="sm:col-span-1 flex items-center justify-center text-purple-400 font-bold">${droneSlotCounter}.</span>
                        <div class="sm:col-span-5 relative">
                            <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'"></div>
                            <input type="number" name="drone_slot_price_${droneSlotCounter}" value="${slot.buyPrice || 0}" placeholder="Compra" min="0" class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-purple-500 text-sm">
                        </div>
                        <div class="sm:col-span-5 relative">
                            <div class="absolute left-2 top-1/2 -translate-y-1/2 flex items-center pointer-events-none"><img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'"></div>
                            <input type="number" name="drone_slot_sell_${droneSlotCounter}" value="${slot.sellPrice || 0}" placeholder="Venta" min="0" class="w-full pl-8 pr-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-green-500 text-sm">
                        </div>
                        <button type="button" onclick="removeDroneSlot(this)" class="sm:col-span-1 px-2 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center"><i data-lucide="x" class="w-4 h-4"></i></button>
                    `;
                    droneContainer.appendChild(slotDiv);
                });
            }
            
            // 11. Recrear requisitos
            const reqsContainer = document.getElementById('requirements-container');
            reqsContainer.innerHTML = '';
            requirementCounter = 0;
            if (ship.requirements && ship.requirements.length > 0) {
                ship.requirements.forEach((req, index) => {
                    requirementCounter = index + 1;
                    const reqRow = document.createElement('div');
                    reqRow.className = 'requirement-row grid grid-cols-1 sm:grid-cols-12 gap-3';
                    reqRow.innerHTML = `
                        <input type="text" name="requirement_ship_${requirementCounter}" value="${sanitizeText(req.ship || '')}" placeholder="Nombre de nave/plano requerido" class="sm:col-span-9 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                        <input type="number" name="requirement_amount_${requirementCounter}" value="${req.amount || 1}" placeholder="Cantidad" min="1" class="sm:col-span-2 px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:border-red-500">
                        <button type="button" onclick="removeRequirementField(this)" class="sm:col-span-1 px-3 py-2 bg-red-500/20 hover:bg-red-500/30 rounded text-red-400 border border-red-500/50 flex items-center justify-center"><i data-lucide="x" class="w-4 h-4"></i></button>
                    `;
                    reqsContainer.appendChild(reqRow);
                });
            }
            
            // Actualizar iconos
            lucide.createIcons();
            notify(`Editando nave: ${ship.name}`, 'info');
            }
        
        function cancelEditShip() {
    const hiddenInput = document.querySelector('[name="editingShipId"]');
    if (hiddenInput) hiddenInput.remove();
    
    const formTitle = document.querySelector('#ships-form h3');
    formTitle.innerHTML = `
        <i data-lucide="plus-circle" class="w-5 h-5 inline"></i>Agregar Nueva Nave
    `;
    
    lucide.createIcons();
    toggleForm('ships');
}

        function loadComponents() {
    console.log('[Admin Panel] loadComponents iniciado');
    const container = document.getElementById('components-list');
    const components = DB.components();
    console.log(`[Admin Panel] Componentes encontrados: ${components.length}`);
    
    if (!components.length) {
        container.innerHTML = '<div class="content-panel p-8 text-center"><p class="text-gray-400">No hay componentes registrados. ¬°Agrega el primero!</p></div>';
        lucide.createIcons();
        return;
    }
    
    const categoryLabels = {
        basicos: '‚öôÔ∏è B√°sicos',
        tormenta: '‚ö° Tormenta',
        tanque: 'üõ°Ô∏è Tanque',
        ingeniera: 'üîß Ingeniera',
        paralizador: 'üí• Paralizador',
        sniper: 'üéØ Sniper',
        minadora: '‚õèÔ∏è Minadora',
        evento: 'üéâ Evento',
        especial: '‚ú® Especial'
    };
    
    const typeLabels = {
        weapon: 'üî´ Arma',
        shield: 'üõ°Ô∏è Escudo',
        engine: 'üöÄ Motor',
        generator: '‚ö° Generador',
        drone: 'ü§ñ Dron',
        special: '‚ú® Especial'
    };
    
    const rarityLabels = {
        common: '‚ö™ Com√∫n',
        uncommon: 'üü¢ Poco Com√∫n',
        rare: 'üîµ Raro',
        epic: 'üü£ √âpico',
        legendary: 'üü† Legendario'
    };
    
    const blueprintTypeLabels = {
        basico: 'üîµ B√°sico',
        dorado: 'üü° Dorado',
        celeste: 'üî∑ Celeste',
        azul_celeste: 'üî∑ Celeste',
        azul_encriptado: 'üîê Azul Encriptado',
        dorado_encriptado: 'üîí Dorado Encriptado',
        celeste_encriptado: 'üîì Celeste Encriptado'
    };
    
    const obtainMethodLabels = {
        drop: 'üíÄ Drop',
        evento: 'üéâ Evento',
        tienda: 'üõí Tienda',
        planos: 'üìã Planos',
        mision: 'üìú Misi√≥n',
        boss: 'üëπ Boss',
        premium: '‚≠ê Premium'
    };
    
    container.innerHTML = components.map(comp => {
        return `
            <div class="content-panel p-5 hover:border-green-400 transition">
                <div class="flex justify-between items-start gap-4">
                    <div class="flex gap-4 flex-1">
                        ${comp.image ? `
                            <div class="flex-shrink-0">
                                <img src="${comp.image}" alt="${sanitizeText(comp.name)}" 
                                     class="w-16 h-16 rounded-lg border border-gray-700 object-contain bg-gray-800/50"
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2264%22 height=%2264%22%3E%3Crect fill=%22%23374151%22 width=%2264%22 height=%2264%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%239ca3af%22 font-size=%2224%22%3E‚ùì%3C/text%3E%3C/svg%3E'">
                            </div>
                        ` : ''}
                        
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2 flex-wrap">
    <h3 class="font-bold text-green-300 text-lg">
        ${comp.componentClass ? getComponentClassIcon(comp.componentClass) : '‚öôÔ∏è'} 
        ${sanitizeText(comp.name)}
    </h3>
    ${comp.componentClass ? `
        <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/50">
            ${comp.componentClass.replace('_', ' ')}
        </span>
    ` : ''}
                                <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/50">
                                    Nivel ${comp.level}
                                </span>
                                ${comp.blueprintType ? `
                                    <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/50">
                                        ${blueprintTypeLabels[comp.blueprintType] || comp.blueprintType}
                                    </span>
                                ` : ''}
                            </div>
                            
                            <div class="flex gap-4 text-sm text-gray-400 mb-2 flex-wrap">
                                ${comp.category ? `<span>${categoryLabels[comp.category] || comp.category}</span>` : ''}
                                ${comp.type ? `<span>‚Ä¢</span><span>${typeLabels[comp.type] || comp.type}</span>` : ''}
                                ${comp.rarity ? `<span>‚Ä¢</span><span>${rarityLabels[comp.rarity] || comp.rarity}</span>` : ''}
                                ${comp.power ? `<span>‚Ä¢</span><span class="text-white font-semibold">‚ö° ${comp.power}</span>` : ''}
                            </div>
                            
                            ${comp.priceCrionita || comp.priceGold || comp.sellPrice ? `
                                <div class="flex gap-4 mt-2 text-sm flex-wrap">
                                    ${comp.priceCrionita ? `
                                        <div class="inline-flex items-center gap-1 bg-yellow-500/10 px-2 py-1 rounded border border-yellow-500/30">
                                            <span class="text-gray-400">Compra:</span>
                                            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4" onerror="this.style.display='none'">
                                            <span class="text-yellow-400">${formatNumber(comp.priceCrionita)}</span>
                                        </div>
                                    ` : ''}
                                    ${comp.priceGold ? `
                                        <div class="inline-flex items-center gap-1 bg-orange-500/10 px-2 py-1 rounded border border-orange-500/30">
                                            <span class="text-gray-400">Oro:</span>
                                            <img src="/assets/currencies/gold.png" alt="Oro" class="w-4 h-4" onerror="this.style.display='none'">
                                            <span class="text-orange-400">${formatNumber(comp.priceGold)}</span>
                                        </div>
                                    ` : ''}
                                    ${comp.sellPrice ? `
                                        <div class="inline-flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded border border-green-500/30">
                                            <span class="text-gray-400">Venta:</span>
                                            <img src="/assets/currencies/crionita.png" alt="Crionita" class="w-4 h-4 opacity-70" onerror="this.style.display='none'">
                                            <span class="text-green-400">${formatNumber(comp.sellPrice)}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                            
                            ${comp.blueprintsForItem || comp.blueprintsToDecrypt ? `
                                <div class="flex gap-3 mt-2 text-xs text-gray-400 flex-wrap">
                                    ${comp.blueprintsForItem ? `<span>üìã Dropea ${comp.blueprintsForItem} planos</span>` : ''}
                                    ${comp.blueprintsToDecrypt ? `<span>üîì Requiere ${comp.blueprintsToDecrypt} planos para descifrar</span>` : ''}
                                </div>
                            ` : ''}
                            
                            ${comp.obtainMethod ? `
                                <p class="text-xs text-gray-400 mt-2">
                                    ${obtainMethodLabels[comp.obtainMethod] || comp.obtainMethod}
                                    ${comp.obtainLocation ? ` ‚Ä¢ ${sanitizeText(comp.obtainLocation)}` : ''}
                                </p>
                            ` : ''}
                            
                            ${comp.requirements && comp.requirements.length > 0 ? `
                                <p class="text-xs text-red-400 mt-1">üîí Requisitos: ${comp.requirements.map(r => `${r.amount}x ${r.item}`).join(', ')}</p>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="flex gap-2 flex-shrink-0">
                        <button onclick="editComponent('${comp.id}')" 
                                class="game-nav-item px-3 py-2 text-sm hover:bg-green-500/20" title="Editar">
                            <i data-lucide="edit" class="w-4 h-4"></i>
                        </button>
                        <button onclick="deleteItem('components', '${comp.id}')" 
                                class="game-nav-item px-3 py-2 text-sm hover:bg-red-500/20" title="Eliminar">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    lucide.createIcons();
    console.log('[Admin Panel] loadComponents completado');
}

        function editComponent(componentId) {
    const components = DB.components();
    const comp = components.find(c => c.id === componentId);
    
    if (!comp) {
        notify('Componente no encontrado', 'error');
        return;
    }
    
    // Mostrar formulario
    const form = document.getElementById('components-form');
    form.classList.remove('hidden');
    form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Llenar campos b√°sicos
    document.getElementById('component-name').value = comp.name || '';
    document.getElementById('component-class').value = comp.componentClass || '';
    document.getElementById('component-level').value = comp.level || 1;
    document.getElementById('component-system').value = comp.system || '';
    
    // ... llenar resto de campos (categor√≠a, tipo, precios, etc.)
    
    notify(`Editando componente: ${comp.name}`, 'info');
    lucide.createIcons();
}
        
        function loadPlanets() {
            const container = document.getElementById('planets-list');
            const planets = DB.planets();
            if (!planets.length) {
                container.innerHTML = '<div class="content-panel p-8 text-center"><p class="text-gray-400">No hay planetas</p></div>';
                lucide.createIcons();
                return;
            }
            container.innerHTML = planets.map(planet => `
                <div class="content-panel p-5 hover:border-purple-400 transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-purple-300">${sanitizeText(planet.name)}</h3>
                            <p class="text-sm text-gray-400">Sistema: ${sanitizeText(planet.system)} | Tipo: ${sanitizeText(planet.type)}</p>
                            <p class="text-xs text-gray-500 mt-2">Nivel ${planet.minLevel} | Facci√≥n: ${sanitizeText(planet.faction || 'N/A')}</p>
                        </div>
                        <button onclick="deleteItem('planets', '${planet.id}')" class="game-nav-item px-3 py-2 text-sm hover:bg-red-500/20">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }
        
        function loadSystems() {
            const container = document.getElementById('systems-list');
            const systems = DB.systems();
            if (!systems.length) {
                container.innerHTML = '<div class="content-panel p-8 text-center"><p class="text-gray-400">No hay sistemas</p></div>';
                lucide.createIcons();
                return;
            }
            container.innerHTML = systems.map(system => `
                <div class="content-panel p-5 hover:border-yellow-400 transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-yellow-300">${sanitizeText(system.name)}</h3>
                            <p class="text-sm text-gray-400">ID: ${sanitizeText(system.id)} | Tipo: ${sanitizeText(system.type)}</p>
                            <p class="text-xs text-gray-500 mt-2">Nivel M√≠n: ${system.minLevel} | Planetas: ${system.planetCount || 0}</p>
                        </div>
                        <button onclick="deleteItem('systems', '${system.id}')" class="game-nav-item px-3 py-2 text-sm hover:bg-red-500/20">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }
        
        function loadUsers() {
            const container = document.getElementById('users-list');
            const users = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key?.startsWith('pirate-user-') && key !== 'pirate-user') {
                    try {
                        const user = JSON.parse(localStorage.getItem(key));
                        if (user?.username) users.push(user);
                    } catch {}
                }
            }
            if (!users.length) {
                container.innerHTML = '<div class="content-panel p-8 text-center"><p class="text-gray-400">No hay usuarios</p></div>';
                lucide.createIcons();
                return;
            }
            container.innerHTML = users.map(user => `
                <div class="content-panel p-4 flex justify-between items-center">
                    <div>
                        <p class="font-bold">${sanitizeText(user.username)}</p>
                        <p class="text-xs text-gray-400">${sanitizeText(user.email || '')}</p>
                    </div>
                    <span class="px-3 py-1 rounded text-xs ${user.role === 'admin' ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}">
                        ${user.role === 'admin' ? 'üîê ADMIN' : 'üë§ USER'}
                    </span>
                </div>
            `).join('');
            lucide.createIcons();
        }
        
        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        
        function deleteItem(type, id) {
            const collection = DB[type]?.();
            if (!Array.isArray(collection)) return;
            const item = collection.find(el => el.id === id);
            if (!item) {
                notify('Elemento no encontrado', 'error');
                return;
            }
            
            const typeLabels = {
                ships: 'nave',
                components: 'componente',
                planets: 'planeta',
                systems: 'sistema'
            };
            
            if (!confirm(`¬øEst√°s seguro de eliminar ${typeLabels[type]} "${item.name || item.id}"?
            Esta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            DB.save(type, collection.filter(el => el.id !== id));
            notify(`${typeLabels[type].charAt(0).toUpperCase() + typeLabels[type].slice(1)} eliminado correctamente`, 'success');
            loadTab(type);
        }
        
        function exportDatabase() {
            const data = { 
                ships: DB.ships(), 
                components: DB.components(), 
                planets: DB.planets(), 
                systems: DB.systems(), 
                exportedAt: new Date().toISOString(),
                version: '3.2'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pirate-galaxy-backup-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            notify('Base de datos exportada correctamente', 'success');
        }
        
        function importDatabase() {
            document.getElementById('import-file').click();
        }
        
        document.addEventListener('change', (event) => {
            if (event.target.id !== 'import-file') return;
            const file = event.target.files?.[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data.ships)) localStorage.setItem(STORAGE_KEYS.ships, JSON.stringify(data.ships));
                    if (Array.isArray(data.components)) localStorage.setItem(STORAGE_KEYS.components, JSON.stringify(data.components));
                    if (Array.isArray(data.planets)) localStorage.setItem(STORAGE_KEYS.planets, JSON.stringify(data.planets));
                    if (Array.isArray(data.systems)) localStorage.setItem(STORAGE_KEYS.systems, JSON.stringify(data.systems));
                    notify('Importaci√≥n exitosa. Recargando...', 'success');
                    setTimeout(() => window.location.reload(), 1000);
                } catch { 
                    notify('Error al importar: archivo JSON inv√°lido', 'error'); 
                }
            };
            reader.readAsText(file);
        });
        
        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        function executeInlineScripts(root) {
            root.querySelectorAll('script').forEach((oldScript) => {
                if (oldScript.src && oldScript.src.includes('component-loader')) {
                    console.log('[Admin Panel] Bloqueando component-loader.js');
                    return;
                }
                const newScript = document.createElement('script');
                [...oldScript.attributes].forEach(attr => newScript.setAttribute(attr.name, attr.value));
                newScript.textContent = oldScript.textContent || '';
                if (oldScript.src) newScript.src = oldScript.src;
                oldScript.parentNode.replaceChild(newScript, oldScript);
            });
        }
        
        function injectHTML(containerId, html) {
            const container = document.getElementById(containerId);
            container.innerHTML = html;
            executeInlineScripts(container);
        }
        
        async function loadLayout() {
            try {
                const [headerResp, footerResp] = await Promise.all([
                    fetch('components/header.html'),
                    fetch('components/footer.html')
                ]);
                if (!headerResp.ok || !footerResp.ok) throw new Error('Error al cargar componentes');
                const [headerHtml, footerHtml] = await Promise.all([headerResp.text(), footerResp.text()]);
                injectHTML('header-container', headerHtml);
                injectHTML('footer-container', footerHtml);
                lucide.createIcons();
            } catch (error) {
                console.error(error);
                notify('Error al cargar la interfaz', 'error');
            }
        }
        
        async function initAdmin() {
            console.log('[Admin Panel] Iniciando...');
            if (!auth.isLoggedIn()) { 
                window.location.href = 'login.html'; 
                return; 
            }
            
            const user = auth.getCurrentUser();
            if (!user || user.role !== 'admin') {
                document.getElementById('not-admin').classList.remove('hidden');
                lucide.createIcons();
                return;
            }
            
            document.getElementById('admin-content').classList.remove('hidden');
            setupTabNavigation();
            updateStats();
            
            console.log('[Admin Panel] Cargando tab ships...');
            loadTab('ships');
            lucide.createIcons();
            
            console.log('[Admin Panel] Inicializaci√≥n completa - v3.2');
        }
        
        function setupTabNavigation() {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    btn.classList.add('active');
                    const tabId = btn.dataset.tab;
                    const tabElement = document.getElementById(tabId);
                    if (tabElement) {
                        tabElement.classList.remove('hidden');
                        loadTab(tabId);
                        console.log(`[Admin Panel] Tab cambiada a: ${tabId}`);
                    }
                });
            });
        }
        
        function loadTab(tabId) {
            console.log(`[Admin Panel] loadTab: ${tabId}`);
            const loaders = { 
                ships: loadShips, 
                components: loadComponents, 
                planets: loadPlanets, 
                systems: loadSystems, 
                users: loadUsers 
            };
            loaders[tabId]?.();
        }
        
        // Iniciar aplicaci√≥n
        (async () => { 
            await initAdmin(); 
            await loadLayout(); 
            console.log('[Admin Panel] Todo cargado - v3.2');
        })();
    </script>

    <style>
        .animate-fadeIn { 
            animation: fadeIn 0.3s ease-out; 
        }
        
        @keyframes fadeIn { 
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        
        .tab-button { 
            color: #9ca3af; 
            transition: all 0.2s; 
        }
        
        .tab-button:hover { 
            color: #d1d5db; 
        }
        
        .tab-button.active { 
            background: linear-gradient(135deg, rgba(70, 120, 200, 0.8), rgba(50, 90, 160, 0.9)); 
            color: #fff; 
        }
        
        #footer-container footer {
            background: linear-gradient(180deg, rgba(15, 20, 30, 0.95), rgba(28, 35, 48, 0.96));
            border-top: 1px solid rgba(100, 150, 255, 0.35);
            color: #9CA3AF;
        }
        
        #footer-container footer a { 
            color: #93c5fd; 
        }
        
        #footer-container footer a:hover { 
            color: #bfdbfe; 
        }
        
        :root[data-theme="light"] #footer-container footer {
            background: linear-gradient(180deg, rgba(245, 247, 252, 0.98), rgba(232, 238, 248, 0.98));
            border-top: 1px solid rgba(120, 135, 160, 0.35);
            color: #4B5563;
        }
        
        :root[data-theme="light"] #footer-container footer a { 
            color: #2563eb; 
        }
        
        :root[data-theme="light"] #footer-container footer a:hover { 
            color: #1d4ed8; 
        }
        
        #ships:not(.hidden) {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #notifications > div {
            transition: all 0.3s ease-out;
        }

        /* üî• ICONOS DE MONEDA EN LABELS */
        .currency-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .currency-label img {
            width: 18px;
            height: 18px;
            object-fit: contain;
            flex-shrink: 0;
        }

        /* üî• ICONOS DENTRO DE INPUTS */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* üî• TRUNCAR TEXTO LARGO */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>

</body>
</html>